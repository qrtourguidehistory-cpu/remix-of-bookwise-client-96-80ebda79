import{v as h,a as g,r as c,x as n}from"./index-CnnmV7T0.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y=h("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);function F(){const{user:r}=g(),[u,a]=c.useState(new Set),[v,d]=c.useState(!1),i=c.useCallback(async()=>{if(!r){a(new Set);return}try{d(!0);const{data:e,error:t}=await n.from("favorites").select("business_id").eq("user_id",r.id);if(t)throw t;const s=new Set;(e||[]).forEach(o=>{o.business_id&&s.add(o.business_id)}),a(s)}catch(e){console.error("Error fetching favorites:",e)}finally{d(!1)}},[r]);c.useEffect(()=>{if(!(r!=null&&r.id)){a(new Set);return}i();const e=n.channel(`favorites-${r.id}`).on("postgres_changes",{event:"*",schema:"public",table:"favorites",filter:`user_id=eq.${r.id}`},t=>{console.log("Favorites changed:",t),i()}).subscribe();return()=>{n.removeChannel(e)}},[r==null?void 0:r.id,i]);const f=async e=>{if(!r)return{error:new Error("User not logged in")};try{const{data:t}=await n.from("businesses").select("id").eq("id",e).maybeSingle();if(!t)throw new Error("Business not found in database");const{error:s}=await n.from("favorites").insert({user_id:r.id,business_id:e});if(s)throw s;return a(o=>new Set([...o,e])),{error:null}}catch(t){return console.error("Error adding favorite:",t),{error:t}}},l=async e=>{if(!r)return{error:new Error("User not logged in")};try{const{error:t}=await n.from("favorites").delete().eq("user_id",r.id).eq("business_id",e);if(t)throw t;return a(s=>{const o=new Set(s);return o.delete(e),o}),{error:null}}catch(t){return console.error("Error removing favorite:",t),{error:t}}};return{favoriteIds:u,loading:v,addFavorite:f,removeFavorite:l,toggleFavorite:async e=>u.has(e)?l(e):f(e),isFavorite:e=>u.has(e),refetch:i}}export{y as H,F as u};
