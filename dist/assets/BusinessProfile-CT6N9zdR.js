import{v as te,j as e,C as v,B as d,S as ne,u as ae,b as oe,a as ce,r as i,N as R,Q as E,c as w}from"./index-CuCDr45z.js";import{I as ie}from"./ImageCarousel-BpzCLRVf.js";import{a as le}from"./useEstablishments-DTavIRtO.js";import{u as de,H as ue}from"./useFavorites-BVGVPVN5.js";import{u as me,g as xe}from"./useBusinessHours-Cp9HmwS_.js";import{S as p}from"./skeleton-Bj54gEsZ.js";import{f as he}from"./format-2GL3XrvW.js";import{A as U}from"./arrow-left-CddgBwaO.js";import{S as fe}from"./star-D7n3xgyo.js";import{M as z}from"./map-pin-BUEZROFf.js";import{P as pe}from"./phone-D8XS6rNu.js";import{E as B}from"./external-link-Cg3Fiuan.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=te("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);function je({service:a,onSelect:x,selected:n}){a.currency;const g=a.price_rd!==void 0&&a.price_rd!==null?Number(a.price_rd):a.price?Number(a.price):0,j=a.price_usd!==void 0&&a.price_usd!==null?Number(a.price_usd):0;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-card rounded-xl border border-border hover:border-primary/30 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsx("h4",{className:"font-medium text-foreground",children:a.name}),a.description&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1 mt-0.5",children:a.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-muted-foreground",children:[e.jsx(v,{className:"w-3.5 h-3.5 text-gray-600",strokeWidth:2}),e.jsxs("span",{children:[a.duration," min"]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-foreground",children:["RD$ ",g.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["USD $",j.toFixed(2)]})]}),e.jsx(d,{variant:n?"coral":"coral-outline",size:"sm",onClick:()=>x(a),children:n?"Seleccionado":"Seleccionar"})]})]})}const Pe=()=>{const{id:a}=ne(),x=ae(),{t:n}=oe(),{user:g,isGuest:j}=ce(),{isFavorite:F,toggleFavorite:H}=de(),{establishment:s,services:N,paymentMethods:_,loading:I,error:$,refetch:m}=le(a),{hours:k}=me(a),[l,W]=i.useState([]),[A,D]=i.useState(!1),h=i.useRef(null),f=i.useRef(null),u=i.useMemo(()=>{if(!s||!s.temporarily_closed)return!1;if(!s.closed_until)return s.temporarily_closed;const r=new Date(s.closed_until),t=new Date;return s.temporarily_closed===!0&&r>t},[s]);i.useEffect(()=>{if(!(s!=null&&s.temporarily_closed)||!(s!=null&&s.closed_until))return;const r=new Date(s.closed_until),t=new Date;if(r<=t)return;const o=r.getTime()-t.getTime(),c=setTimeout(()=>{m()},o+1e3);return()=>clearTimeout(c)},[s==null?void 0:s.closed_until,s==null?void 0:s.temporarily_closed,m]),i.useEffect(()=>{if(!(s!=null&&s.temporarily_closed)||!(s!=null&&s.closed_until))return;const r=setInterval(()=>{new Date(s.closed_until)<=new Date&&m()},3e4);return()=>clearInterval(r)},[s==null?void 0:s.closed_until,s==null?void 0:s.temporarily_closed,m]);const S=i.useMemo(()=>{if(!u||!(s!=null&&s.closed_until))return null;try{const r=new Date(s.closed_until);return he(r,"HH:mm")}catch{return null}},[u,s==null?void 0:s.closed_until]),L=async()=>{if(!A){D(!0);try{await m()}finally{D(!1)}}},Y=r=>{h.current=r.touches[0].clientY},q=r=>{f.current=r.touches[0].clientY},O=()=>{if(!h.current||!f.current)return;h.current-f.current<-50&&window.scrollY===0&&L(),h.current=null,f.current=null},C=i.useMemo(()=>{if(u)return!1;const r=new Date,t=k||xe(a),o=b=>{const[y,re]=b.split(":").map(Number);return y*60+re},c=r.getHours()*60+r.getMinutes(),ee=o(t.openTime),se=o(t.closeTime);if(t.lunchStart&&t.lunchEnd){const b=o(t.lunchStart),y=o(t.lunchEnd);if(c>=b&&c<y)return!1}return c>=ee&&c<se},[k,a,u]),G=r=>{W(t=>t.find(c=>c.id===r.id)?t.filter(c=>c.id!==r.id):[...t,r])},Q=async()=>{if(j||!g){E({title:n("common.loginRequired"),description:n("favorites.loginToSave"),variant:"destructive"});return}a&&await H(a)},J=l.reduce((r,t)=>r+(t.price_rd||t.price||0),0),T=l.reduce((r,t)=>r+(t.price_usd||0),0),K=l.reduce((r,t)=>r+t.duration,0),V=()=>{const r=(s==null?void 0:s.phone)||"";r&&(window.location.href=`tel:${r.replace(/\s/g,"")}`)},X=()=>{const r=s==null?void 0:s.google_maps_url,t=(s==null?void 0:s.address)||"";if(r)window.open(r,"_blank");else if(t){const o=encodeURIComponent(t);window.open(`https://www.google.com/maps/search/?api=1&query=${o}`,"_blank")}};if(I)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"relative h-56 bg-gradient-to-br from-secondary to-muted",children:[e.jsx(p,{className:"w-full h-full"}),e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 flex items-center justify-between z-10",children:e.jsx(d,{variant:"secondary",size:"icon",className:"rounded-full",onClick:()=>x(-1),children:e.jsx(U,{className:"w-5 h-5"})})})]}),e.jsx("div",{className:"max-w-lg mx-auto px-4 -mt-8 relative z-10",children:e.jsxs("div",{className:"bg-card rounded-2xl shadow-card p-5",children:[e.jsx(p,{className:"h-6 w-48 mb-2"}),e.jsx(p,{className:"h-4 w-32 mb-3"}),e.jsx(p,{className:"h-20 w-full"})]})})]});if($||!s)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center px-4",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground mb-2",children:n("common.error")}),e.jsx("p",{className:"text-muted-foreground mb-4",children:n("business.notFound")}),e.jsx(d,{variant:"coral",onClick:()=>x("/"),children:n("common.goBack")})]})});console.log("BusinessProfile - dbServices received:",N.length,N.map(r=>({id:r.id,name:r.name})));const M=N.map(r=>{const t=r.price_rd!==void 0?Number(r.price_rd):Number(r.price||0),o=r.price_usd!==void 0?Number(r.price_usd):0;return{id:r.id,name:r.name,description:r.description||"",duration:r.duration_minutes||30,price:Number(r.price||0),price_rd:t,price_usd:o,price_currency:r.price_currency||"DOP",currency:r.price_currency||"DOP"}}),P=s.main_image?[s.main_image]:[],Z=a?F(a):!1;return e.jsxs("div",{className:"min-h-screen bg-background",onTouchStart:Y,onTouchMove:q,onTouchEnd:O,children:[e.jsxs("div",{className:"relative h-56 bg-gradient-to-br from-secondary to-muted",children:[P.length>0?e.jsx(ie,{images:P,alt:s.name}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-muted",children:e.jsx("span",{className:"text-muted-foreground",children:n("business.noImage")})}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 flex items-center justify-between z-10",children:[e.jsx(R,{to:"/",children:e.jsx(d,{variant:"secondary",size:"icon",className:"rounded-full shadow-card",children:e.jsx(U,{className:"w-5 h-5"})})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{variant:"secondary",size:"icon",className:"rounded-full shadow-card",onClick:()=>{const r=window.location.href,t=`Check out ${s.name}!`;navigator.share?navigator.share({title:s.name,text:t,url:r}):(navigator.clipboard.writeText(r),E({title:n("common.linkCopied")}))},children:e.jsx(ge,{className:"w-5 h-5"})}),e.jsx(d,{variant:"secondary",size:"icon",className:"rounded-full shadow-card",onClick:Q,children:e.jsx(ue,{className:w("w-5 h-5 transition-colors",Z&&"fill-primary text-primary")})})]})]})]}),e.jsxs("div",{className:w("max-w-lg mx-auto px-4 -mt-8 relative z-10",l.length>0?"pb-36":"pb-8"),children:[e.jsxs("div",{className:"bg-card rounded-2xl shadow-card p-5 animate-slide-up",children:[e.jsx("h1",{className:"text-xl font-bold text-foreground mb-2",children:s.name}),e.jsxs("div",{className:"flex items-center gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"w-4 h-4 text-warning fill-warning"}),e.jsx("span",{className:"font-semibold text-foreground",children:s.rating||0}),e.jsxs("span",{className:"text-muted-foreground text-sm",children:["(",s.review_count||0," ",n("business.reviews"),")"]})]}),s.address&&e.jsxs("span",{className:"flex items-center gap-1 text-muted-foreground text-sm",children:[e.jsx(z,{className:"w-4 h-4 text-gray-700",strokeWidth:2}),s.address]})]}),s.description&&e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:s.description}),e.jsx("div",{className:"flex items-center gap-4 text-sm",children:u?e.jsxs("div",{className:"flex flex-col gap-1 w-full bg-warning/10 p-3 rounded-lg border border-warning/20 animate-fade-in",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-destructive font-semibold",children:[e.jsx(v,{className:"w-4 h-4",strokeWidth:2}),n("business.temporarilyClosed")]}),S&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:[n("business.reopensAt")," ",S]})]}):e.jsxs("span",{className:w("flex items-center gap-1.5",C?"text-success":"text-destructive"),children:[e.jsx(v,{className:"w-4 h-4 text-gray-700",strokeWidth:2}),n(C?"business.openNow":"business.closedNow")]})})]}),e.jsxs("section",{className:"mt-6 animate-slide-up",style:{animationDelay:"0.1s"},children:[e.jsx("h2",{className:"text-lg font-bold text-foreground mb-4",children:n("business.services")}),M.length>0?e.jsx("div",{className:"space-y-3",children:M.map(r=>e.jsx(je,{service:r,onSelect:G,selected:l.some(t=>t.id===r.id)},r.id))}):e.jsx("div",{className:"bg-card rounded-xl border border-border p-4 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:n("business.noServices")})})]}),(s.phone||s.address)&&e.jsxs("section",{className:"mt-6 animate-slide-up",style:{animationDelay:"0.15s"},children:[e.jsx("h2",{className:"text-lg font-bold text-foreground mb-4",children:n("business.contact")}),e.jsxs("div",{className:"bg-card rounded-xl border border-border p-4 space-y-3",children:[s.phone&&e.jsxs("button",{onClick:V,className:"w-full flex items-center gap-3 hover:bg-secondary/50 -mx-2 px-2 py-2 rounded-lg transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center",children:e.jsx(pe,{className:"w-5 h-5 text-gray-700",strokeWidth:2})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:n("business.phone")}),e.jsx("p",{className:"font-medium text-foreground",children:s.phone})]}),e.jsx(B,{className:"w-4 h-4 text-gray-500",strokeWidth:2})]}),s.address&&e.jsxs("button",{onClick:X,className:"w-full flex items-center gap-3 hover:bg-secondary/50 -mx-2 px-2 py-2 rounded-lg transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center",children:e.jsx(z,{className:"w-5 h-5 text-gray-700",strokeWidth:2})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:n("business.address")}),e.jsx("p",{className:"font-medium text-foreground",children:s.address})]}),e.jsx(B,{className:"w-4 h-4 text-gray-500",strokeWidth:2})]})]})]}),e.jsxs("section",{className:"mt-6 animate-slide-up",style:{animationDelay:"0.2s"},children:[e.jsx("h2",{className:"text-lg font-bold text-foreground mb-4",children:n("business.paymentMethods")}),e.jsxs("div",{className:"bg-card rounded-xl border border-border p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:n("business.paymentMethodsDesc")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:_.length>0?_.map(r=>e.jsx("span",{className:"px-3 py-1 bg-secondary text-secondary-foreground text-xs rounded-full",children:r.name},r.id)):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"px-3 py-1 bg-secondary text-secondary-foreground text-xs rounded-full",children:n("business.cash")}),e.jsx("span",{className:"px-3 py-1 bg-secondary text-secondary-foreground text-xs rounded-full",children:n("business.creditCard")})]})})]})]}),e.jsxs("section",{className:"mt-6 animate-slide-up",style:{animationDelay:"0.25s"},children:[e.jsx("h2",{className:"text-lg font-bold text-foreground mb-4",children:n("business.cancellationPolicy")}),e.jsxs("div",{className:"bg-warning/10 rounded-xl border border-warning/20 p-4",children:[e.jsxs("p",{className:"text-sm text-foreground",children:[n("business.cancellationPolicyText")," ",e.jsx("strong",{children:n("business.cancellationHours")}),"."]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:n("business.cancellationNote")})]})]})]}),l.length>0&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-card border-t border-border p-4 shadow-elevated z-50 animate-slide-up",style:{paddingBottom:"calc(1rem + env(safe-area-inset-bottom))"},children:e.jsxs("div",{className:"max-w-lg mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[l.length," ",n("business.services_count")," â€¢ ",K," ",n("business.min")]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-foreground",children:["RD$ ",J.toLocaleString()]}),T>0&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["USD $",T.toFixed(2)]})]})]})}),u?e.jsx(d,{variant:"coral",size:"xl",className:"w-full",disabled:!0,children:n("business.temporarilyClosed")}):e.jsx(R,{to:`/booking/${a}`,state:{services:l},children:e.jsx(d,{variant:"coral",size:"xl",className:"w-full",children:n("business.continueBooking")})})]})})]})};export{Pe as default};
