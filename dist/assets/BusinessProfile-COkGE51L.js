import{o as de,j as e,C as M,B as h,r as l,s as H,a2 as ue,u as me,b as xe,a as ge,L as W,J as q,c as B}from"./index-DQJT4g5E.js";import{I as fe,a as pe}from"./ImageCarousel-CIKNZj-6.js";import{u as he}from"./useEstablishments-CXioiknH.js";import{u as je,H as Ne}from"./useFavorites-B22DN5Gh.js";import{u as ye,g as we}from"./useBusinessHours-A4TxQlFa.js";import{S as $}from"./skeleton-BDRgUS51.js";import{Browser as be}from"./index-Cbghm6sw.js";import{u as ve}from"./useDebounce-rG93BeuF.js";import{f as _e}from"./format-DkUrEppP.js";import{A as V}from"./arrow-left-COyHvJ2K.js";import{S as Se}from"./star-BhxkPCl1.js";import{M as Y}from"./map-pin-CRDSxsYe.js";import{P as De}from"./phone-BgYWs0vt.js";import{E as J}from"./external-link-7_N_QYWE.js";import"./chevron-left-JJTa5Mkh.js";import"./chevron-right-Dv7Xa5A7.js";import"./OptimizedImage-DBzFcGB6.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=de("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);function Ce({service:o,onSelect:N,selected:n}){o.currency;const b=o.price_rd!==void 0&&o.price_rd!==null?Number(o.price_rd):o.price?Number(o.price):0,y=o.price_usd!==void 0&&o.price_usd!==null?Number(o.price_usd):0;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-card rounded-xl border border-border hover:border-primary/30 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsx("h4",{className:"font-medium text-foreground",children:o.name}),o.description&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1 mt-0.5",children:o.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-muted-foreground",children:[e.jsx(M,{className:"w-3.5 h-3.5 text-gray-600",strokeWidth:2}),e.jsxs("span",{children:[o.duration," min"]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-foreground",children:["RD$ ",b.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["USD $",y.toFixed(2)]})]}),e.jsx(h,{variant:n?"coral":"coral-outline",size:"sm",onClick:()=>N(o),children:n?"Seleccionado":"Seleccionar"})]})]})}function Ie(o){const[N,n]=l.useState([]),[b,y]=l.useState(!1),[T,D]=l.useState(null);return l.useEffect(()=>{if(!o){n([]);return}(async()=>{y(!0),D(null);try{const i=`${o}/gallery`;console.log(`ðŸ” Buscando imÃ¡genes en: business-images/${i} y subcarpetas`);const v=async d=>{var _;const g=[],{data:u,error:f}=await H.storage.from("business-images").list(d,{limit:100,offset:0});if(f)return f.message&&!f.message.includes("not found")&&!f.message.includes("No such file")&&console.warn(`âš ï¸ Error al listar archivos en ${d}:`,f.message),g;if(!u||u.length===0)return g;const k=u.filter(x=>x.name.includes(".")),m=u.filter(x=>!x.name.includes("."));for(const x of k){const p=(_=x.name.split(".").pop())==null?void 0:_.toLowerCase();if(p&&["jpg","jpeg","png","webp","gif","svg"].includes(p)){const S=`${d}/${x.name}`,{data:{publicUrl:C}}=H.storage.from("business-images").getPublicUrl(S);g.push(C)}}for(const x of m){const p=`${d}/${x.name}`;console.log(`ðŸ“‚ Buscando en subcarpeta: business-images/${p}`);const S=await v(p);g.push(...S)}return g},P=await v(i),j=Array.from(new Set(P));n(j),j.length>0?console.log(`âœ… useBusinessGallery: ${j.length} imÃ¡genes encontradas para business_id: ${o}`,{businessId:o,galleryPath:i,imageCount:j.length,images:j}):console.log(`âš ï¸ useBusinessGallery: No se encontraron imÃ¡genes en galerÃ­a para business_id: ${o}`,{businessId:o,galleryPath:i})}catch(i){console.error("âŒ Error fetching gallery images:",i),D(i.message||"Error desconocido al obtener imÃ¡genes"),n([])}finally{y(!1)}})()},[o]),{galleryImages:N,loading:b,error:T}}const Ve=()=>{const{id:o}=ue(),N=me(),{t:n}=xe(),{user:b,isGuest:y}=ge(),{isFavorite:T,toggleFavorite:D}=je(),{establishment:s,services:i,paymentMethods:v,loading:P,error:j,refetch:d}=he(o),{hours:g}=ye(o),{galleryImages:u,loading:f,error:k}=Ie(o),[m,_]=l.useState([]),[x,p]=l.useState(!1),[S,C]=l.useState(!1),I=l.useRef(null),E=l.useRef(null),K=ve(D,500),w=l.useMemo(()=>{if(!s||!s.temporarily_closed)return!1;if(!s.closed_until)return s.temporarily_closed;const r=new Date(s.closed_until),t=new Date;return s.temporarily_closed===!0&&r>t},[s]);l.useEffect(()=>{if(!(s!=null&&s.temporarily_closed)||!(s!=null&&s.closed_until))return;const r=new Date(s.closed_until),t=new Date;if(r<=t)return;const c=r.getTime()-t.getTime(),a=setTimeout(()=>{d()},c+1e3);return()=>clearTimeout(a)},[s==null?void 0:s.closed_until,s==null?void 0:s.temporarily_closed,d]),l.useEffect(()=>{if(!(s!=null&&s.temporarily_closed)||!(s!=null&&s.closed_until))return;const r=setInterval(()=>{new Date(s.closed_until)<=new Date&&d()},3e4);return()=>clearInterval(r)},[s==null?void 0:s.closed_until,s==null?void 0:s.temporarily_closed,d]);const L=l.useMemo(()=>{if(!w||!(s!=null&&s.closed_until))return null;try{const r=new Date(s.closed_until);return _e(r,"HH:mm")}catch{return null}},[w,s==null?void 0:s.closed_until]),Q=async()=>{if(!x){p(!0);try{await d()}finally{p(!1)}}},X=r=>{I.current=r.touches[0].clientY},Z=r=>{E.current=r.touches[0].clientY},ee=()=>{if(!I.current||!E.current)return;I.current-E.current<-50&&window.scrollY===0&&Q(),I.current=null,E.current=null},F=l.useMemo(()=>{if(w)return!1;const r=new Date,t=g||we(o),c=R=>{const[U,ie]=R.split(":").map(Number);return U*60+ie},a=r.getHours()*60+r.getMinutes(),G=c(t.openTime),ce=c(t.closeTime);if(t.lunchStart&&t.lunchEnd){const R=c(t.lunchStart),U=c(t.lunchEnd);if(a>=R&&a<U)return!1}return a>=G&&a<ce},[g,o,w]),se=r=>{_(t=>t.find(a=>a.id===r.id)?t.filter(a=>a.id!==r.id):[...t,r])},re=async()=>{if(y||!b){q({title:n("common.loginRequired"),description:n("favorites.loginToSave"),variant:"destructive"});return}o&&await K(o)};l.useEffect(()=>()=>{_([])},[]);const ne=m.reduce((r,t)=>r+(t.price_rd||t.price||0),0),z=m.reduce((r,t)=>r+(t.price_usd||0),0),te=m.reduce((r,t)=>r+t.duration,0),oe=()=>{const r=(s==null?void 0:s.phone)||"";r&&(window.location.href=`tel:${r.replace(/\s/g,"")}`)},ae=async()=>{const r=s==null?void 0:s.latitude,t=s==null?void 0:s.longitude,c=s==null?void 0:s.address;let a="";if(r&&t)a=`https://www.google.com/maps/search/?api=1&query=${r},${t}`,console.log("ðŸ“ NAVEGANDO CON COORDENADAS GPS:",{lat:r,lng:t}),console.log("ðŸ”— URL:",a);else if(c)a=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(c)}`,console.log("ðŸ“ NAVEGANDO CON DIRECCIÃ“N (sin coordenadas):",c),console.log("ðŸ”— URL:",a);else{console.error("âŒ Sin coordenadas ni direcciÃ³n disponible");return}try{await be.open({url:a,presentationStyle:"popover"})}catch{window.open(a,"_blank")}},A=l.useMemo(()=>{const r=[];if(s!=null&&s.cover_image_url&&r.push(s.cover_image_url),u.length>0){const t=u.filter(c=>!(s!=null&&s.cover_image_url)||c!==s.cover_image_url);r.push(...t)}return r.length===0&&(s!=null&&s.main_image)&&r.push(s.main_image),r.length>0?console.log(`ðŸ–¼ï¸ BusinessProfile: ${r.length} imÃ¡genes cargadas para el carrusel`,{coverImage:s==null?void 0:s.cover_image_url,galleryImagesCount:u.length,galleryLoading:f,galleryError:k,totalImages:r.length,images:r}):console.warn("âš ï¸ BusinessProfile: No hay imÃ¡genes disponibles para el carrusel",{coverImage:s==null?void 0:s.cover_image_url,galleryImagesCount:u.length,galleryLoading:f,galleryError:k,mainImage:s==null?void 0:s.main_image}),r},[s==null?void 0:s.cover_image_url,s==null?void 0:s.main_image,u]),O=l.useMemo(()=>(console.log("BusinessProfile - dbServices received:",i.length,i.map(r=>({id:r.id,name:r.name}))),i.map(r=>{const t=r.price_rd!==void 0?Number(r.price_rd):Number(r.price||0),c=r.price_usd!==void 0?Number(r.price_usd):0;return{id:r.id,name:r.name,description:r.description||"",duration:r.duration_minutes||30,price:Number(r.price||0),price_rd:t,price_usd:c,price_currency:r.price_currency||"DOP",currency:r.price_currency||"DOP"}})),[i]);if(P)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"relative h-56 bg-gradient-to-br from-secondary to-muted",children:[e.jsx($,{className:"w-full h-full"}),e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 flex items-center justify-between z-10",children:e.jsx(h,{variant:"secondary",size:"icon",className:"rounded-full",onClick:()=>N(-1),children:e.jsx(V,{className:"w-5 h-5"})})})]}),e.jsx("div",{className:"max-w-lg mx-auto px-4 -mt-8 relative z-10",children:e.jsxs("div",{className:"bg-card rounded-2xl shadow-card p-5",children:[e.jsx($,{className:"h-6 w-48 mb-2"}),e.jsx($,{className:"h-4 w-32 mb-3"}),e.jsx($,{className:"h-20 w-full"})]})})]});if(j||!s)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center px-4",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground mb-2",children:n("common.error")}),e.jsx("p",{className:"text-muted-foreground mb-4",children:n("business.notFound")}),e.jsx(h,{variant:"coral",onClick:()=>N("/"),children:n("common.goBack")})]})});const le=o?T(o):!1;return e.jsxs("div",{className:"min-h-screen bg-background",onTouchStart:X,onTouchMove:Z,onTouchEnd:ee,children:[e.jsxs("div",{className:"relative h-56 bg-gradient-to-br from-secondary to-muted",children:[A.length>0?e.jsx(fe,{images:A,alt:s.name,clickable:!0}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-muted",children:e.jsx("span",{className:"text-muted-foreground",children:n("business.noImage")})}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 flex items-center justify-between z-10",children:[e.jsx(W,{to:"/",children:e.jsx(h,{variant:"secondary",size:"icon",className:"rounded-full shadow-card",children:e.jsx(V,{className:"w-5 h-5"})})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{variant:"secondary",size:"icon",className:"rounded-full shadow-card",onClick:()=>{const r=window.location.href,t=`Check out ${s.name}!`;navigator.share?navigator.share({title:s.name,text:t,url:r}):(navigator.clipboard.writeText(r),q({title:n("common.linkCopied")}))},children:e.jsx(ke,{className:"w-5 h-5"})}),e.jsx(h,{variant:"secondary",size:"icon",className:"rounded-full shadow-card",onClick:re,children:e.jsx(Ne,{className:B("w-5 h-5 transition-colors",le&&"fill-primary text-primary")})})]})]})]}),e.jsxs("div",{className:B("max-w-lg mx-auto px-4 -mt-8 relative z-10",m.length>0?"pb-36":"pb-8"),children:[e.jsxs("div",{className:"bg-card rounded-2xl shadow-card p-5 animate-slide-up relative",children:[e.jsx("h1",{className:"text-xl font-bold text-foreground mb-2",children:s.name}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Se,{className:"w-4 h-4 text-warning fill-warning"}),e.jsx("span",{className:"font-semibold text-foreground",children:s.rating||0}),e.jsxs("span",{className:"text-muted-foreground text-sm",children:["(",s.review_count||0," ",n("business.reviews"),")"]})]}),s.address&&e.jsxs("span",{className:"flex items-center gap-1 text-muted-foreground text-sm",children:[e.jsx(Y,{className:"w-4 h-4 text-gray-700",strokeWidth:2}),s.address]})]}),s.logo_url&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:s.logo_url,alt:`${s.name} logo`,className:"w-12 h-12 rounded-full object-cover border-2 border-white shadow-md cursor-pointer hover:scale-105 transition-transform flex-shrink-0",onClick:()=>C(!0)}),e.jsx(pe,{images:[s.logo_url],initialIndex:0,isOpen:S,onClose:()=>C(!1),alt:`${s.name} logo`})]})]}),s.description&&e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:s.description}),e.jsx("div",{className:"flex items-center gap-4 text-sm",children:w?e.jsxs("div",{className:"flex flex-col gap-1 w-full bg-warning/10 p-3 rounded-lg border border-warning/20 animate-fade-in",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-destructive font-semibold",children:[e.jsx(M,{className:"w-4 h-4",strokeWidth:2}),n("business.temporarilyClosed")]}),L&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:[n("business.reopensAt")," ",L]})]}):e.jsxs("span",{className:B("flex items-center gap-1.5",F?"text-success":"text-destructive"),children:[e.jsx(M,{className:"w-4 h-4 text-gray-700",strokeWidth:2}),n(F?"business.openNow":"business.closedNow")]})})]}),e.jsxs("section",{className:"mt-6 animate-slide-up",style:{animationDelay:"0.1s"},children:[e.jsx("h2",{className:"text-lg font-bold text-foreground mb-4",children:n("business.services")}),O.length>0?e.jsx("div",{className:"space-y-3",children:O.map(r=>e.jsx(Ce,{service:r,onSelect:se,selected:m.some(t=>t.id===r.id)},r.id))}):e.jsx("div",{className:"bg-card rounded-xl border border-border p-4 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:n("business.noServices")})})]}),(s.phone||s.address)&&e.jsxs("section",{className:"mt-6 animate-slide-up",style:{animationDelay:"0.15s"},children:[e.jsx("h2",{className:"text-lg font-bold text-foreground mb-4",children:n("business.contact")}),e.jsxs("div",{className:"bg-card rounded-xl border border-border p-4 space-y-3",children:[s.phone&&e.jsxs("button",{onClick:oe,className:"w-full flex items-center gap-3 hover:bg-secondary/50 -mx-2 px-2 py-2 rounded-lg transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center",children:e.jsx(De,{className:"w-5 h-5 text-gray-700",strokeWidth:2})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:n("business.phone")}),e.jsx("p",{className:"font-medium text-foreground",children:s.phone})]}),e.jsx(J,{className:"w-4 h-4 text-gray-500",strokeWidth:2})]}),s.address&&e.jsxs("button",{onClick:ae,className:"w-full flex items-center gap-3 hover:bg-secondary/50 -mx-2 px-2 py-2 rounded-lg transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center",children:e.jsx(Y,{className:"w-5 h-5 text-gray-700",strokeWidth:2})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:n("business.address")}),e.jsx("p",{className:"font-medium text-foreground",children:s.address})]}),e.jsx(J,{className:"w-4 h-4 text-gray-500",strokeWidth:2})]})]})]}),e.jsxs("section",{className:"mt-6 animate-slide-up",style:{animationDelay:"0.2s"},children:[e.jsx("h2",{className:"text-lg font-bold text-foreground mb-4",children:n("business.paymentMethods")}),e.jsxs("div",{className:"bg-card rounded-xl border border-border p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:n("business.paymentMethodsDesc")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:v.length>0?v.map(r=>e.jsx("span",{className:"px-3 py-1 bg-secondary text-secondary-foreground text-xs rounded-full",children:r.name},r.id)):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"px-3 py-1 bg-secondary text-secondary-foreground text-xs rounded-full",children:n("business.cash")}),e.jsx("span",{className:"px-3 py-1 bg-secondary text-secondary-foreground text-xs rounded-full",children:n("business.creditCard")})]})})]})]}),e.jsxs("section",{className:"mt-6 animate-slide-up",style:{animationDelay:"0.25s"},children:[e.jsx("h2",{className:"text-lg font-bold text-foreground mb-4",children:n("business.cancellationPolicy")}),e.jsxs("div",{className:"bg-warning/10 rounded-xl border border-warning/20 p-4",children:[e.jsxs("p",{className:"text-sm text-foreground",children:[n("business.cancellationPolicyText")," ",e.jsx("strong",{children:n("business.cancellationHours")}),"."]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:n("business.cancellationNote")})]})]})]}),m.length>0&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-card border-t border-border p-4 shadow-elevated z-50 animate-slide-up",style:{paddingBottom:"calc(1rem + env(safe-area-inset-bottom))"},children:e.jsxs("div",{className:"max-w-lg mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[m.length," ",n("business.services_count")," â€¢ ",te," ",n("business.min")]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-foreground",children:["RD$ ",ne.toLocaleString()]}),z>0&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["USD $",z.toFixed(2)]})]})]})}),w?e.jsx(h,{variant:"coral",size:"xl",className:"w-full",disabled:!0,children:n("business.temporarilyClosed")}):e.jsx(W,{to:`/booking/${o}`,state:{services:m},children:e.jsx(h,{variant:"coral",size:"xl",className:"w-full",children:n("business.continueBooking")})})]})})]})};export{Ve as default};
