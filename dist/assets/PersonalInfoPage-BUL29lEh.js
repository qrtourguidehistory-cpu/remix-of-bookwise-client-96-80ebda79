import{v as z,u as M,b as B,r as c,a as R,j as e,B as I,O as P,Q as l,x as U}from"./index-CnnmV7T0.js";import{I as d}from"./input-BEB3ApMY.js";import{L as h}from"./label-jBxtmpUF.js";import{A as T,a as q,b as H}from"./avatar-D6RhzsTp.js";import{A as $}from"./arrow-left-C3RKvvX0.js";import{U as A}from"./user-uv3ogaFs.js";import{M as O}from"./mail-Dc2qq6V2.js";import{P as Q}from"./phone-Dc1pwBbi.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=z("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),ae=()=>{const p=M(),{t:s}=B(),u=c.useRef(null),{user:o,profile:i,updateProfile:f,refetchProfile:g}=R(),[v,j]=c.useState(!1),[b,N]=c.useState(!1),[y,w]=c.useState(""),[r,n]=c.useState({first_name:"",last_name:"",email:"",phone:""});c.useEffect(()=>{i?(n({first_name:i.first_name||"",last_name:i.last_name||"",email:i.email||(o==null?void 0:o.email)||"",phone:i.phone||""}),w(i.avatar_url||"")):o&&n(a=>({...a,email:o.email||""}))},[i,o]);const E=async()=>{if(!o){l({title:s("common.error"),description:"Debes iniciar sesión para guardar cambios",variant:"destructive"});return}N(!0);try{const a=`${r.first_name} ${r.last_name}`.trim(),{error:t}=await f({first_name:r.first_name,last_name:r.last_name,full_name:a,email:r.email,phone:r.phone,avatar_url:y});if(t)throw t;await g(),l({title:s("common.success"),description:"Tus datos han sido guardados correctamente."})}catch(a){console.error("Error saving profile:",a),l({title:s("common.error"),description:a.message||"No se pudieron guardar los cambios.",variant:"destructive"})}finally{N(!1)}},F=async a=>{var x;const t=(x=a.target.files)==null?void 0:x[0];if(!(!t||!o)){if(t.size>5*1024*1024){l({title:s("common.error"),description:"La imagen debe ser menor a 5MB",variant:"destructive"});return}if(!t.type.startsWith("image/")){l({title:s("common.error"),description:"Solo se permiten archivos de imagen",variant:"destructive"});return}j(!0);try{const m=t.name.split(".").pop(),D=`${o.id}-${Date.now()}.${m}`,_=`avatars/${o.id}/${D}`,{error:k}=await U.storage.from("Logos").upload(_,t,{upsert:!0});if(k)throw k;const{data:{publicUrl:C}}=U.storage.from("Logos").getPublicUrl(_);w(C);const{error:L}=await f({avatar_url:C});if(L)throw L;await g(),l({title:s("common.success"),description:"Foto de perfil actualizada"})}catch(m){console.error("Error uploading image:",m),l({title:s("common.error"),description:m.message||"No se pudo subir la imagen",variant:"destructive"})}finally{j(!1)}}},S=(a,t)=>`${(a==null?void 0:a[0])||""}${(t==null?void 0:t[0])||""}`.toUpperCase()||"U";return o?e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"bg-card border-b border-border sticky top-0 z-10",children:e.jsxs("div",{className:"px-4 py-4 max-w-lg mx-auto flex items-center gap-3",children:[e.jsx("button",{onClick:()=>p(-1),className:"p-2 -ml-2 hover:bg-secondary rounded-lg transition-colors",children:e.jsx($,{className:"w-5 h-5 text-foreground"})}),e.jsx("h1",{className:"text-lg font-semibold text-foreground",children:s("profile.personalInfo")})]})}),e.jsxs("main",{className:"max-w-lg mx-auto px-4 py-6 space-y-6",children:[e.jsxs("section",{className:"flex flex-col items-center gap-4 animate-fade-in",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(T,{className:"w-24 h-24",children:[e.jsx(q,{src:y}),e.jsx(H,{className:"bg-coral-light text-coral text-2xl",children:S(r.first_name,r.last_name)})]}),e.jsx("button",{onClick:()=>{var a;return(a=u.current)==null?void 0:a.click()},disabled:v,className:"absolute bottom-0 right-0 w-8 h-8 bg-coral rounded-full flex items-center justify-center shadow-lg hover:bg-coral-dark transition-colors disabled:opacity-50",children:v?e.jsx(P,{className:"w-4 h-4 text-coral-foreground animate-spin"}):e.jsx(V,{className:"w-4 h-4 text-coral-foreground"})}),e.jsx("input",{ref:u,type:"file",accept:"image/*",onChange:F,className:"hidden"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s("common_ui.tapToChangePhoto")})]}),e.jsxs("section",{className:"space-y-4 animate-fade-in",style:{animationDelay:"0.1s"},children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(h,{htmlFor:"first_name",className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-coral"}),s("profile.firstName")]}),e.jsx(d,{id:"first_name",value:r.first_name,onChange:a=>n({...r,first_name:a.target.value}),placeholder:s("profile.firstNamePlaceholder"),maxLength:50})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(h,{htmlFor:"last_name",className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-coral"}),s("profile.lastName")]}),e.jsx(d,{id:"last_name",value:r.last_name,onChange:a=>n({...r,last_name:a.target.value}),placeholder:s("profile.lastNamePlaceholder"),maxLength:50})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(h,{htmlFor:"email",className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4 text-coral"}),s("booking.email")]}),e.jsx(d,{id:"email",type:"email",value:r.email,onChange:a=>n({...r,email:a.target.value}),placeholder:"tu@email.com",maxLength:255})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(h,{htmlFor:"phone",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-coral"}),s("booking.phone")]}),e.jsx(d,{id:"phone",type:"tel",value:r.phone,onChange:a=>n({...r,phone:a.target.value}),placeholder:"+1 809 555 0000",maxLength:20})]})]}),e.jsx("section",{className:"pt-4 animate-fade-in",style:{animationDelay:"0.2s"},children:e.jsx(I,{variant:"coral",size:"xl",className:"w-full",onClick:E,disabled:b,children:b?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 mr-2 animate-spin"}),s("common.loading")]}):s("common.save")})})]})]}):e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("header",{className:"bg-card border-b border-border sticky top-0 z-10",children:e.jsxs("div",{className:"px-4 py-4 max-w-lg mx-auto flex items-center gap-3",children:[e.jsx("button",{onClick:()=>p(-1),className:"p-2 -ml-2 hover:bg-secondary rounded-lg transition-colors",children:e.jsx($,{className:"w-5 h-5 text-foreground"})}),e.jsx("h1",{className:"text-lg font-semibold text-foreground",children:s("profile.personalInfo")})]})}),e.jsx("main",{className:"max-w-lg mx-auto px-4 py-6",children:e.jsxs("div",{className:"text-center py-16",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Debes iniciar sesión para ver tu perfil"}),e.jsx(I,{variant:"coral",onClick:()=>p("/auth"),children:s("common.login")})]})})]})};export{ae as default};
