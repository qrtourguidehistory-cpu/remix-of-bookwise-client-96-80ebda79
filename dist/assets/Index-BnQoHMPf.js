import{o as Q,r as i,j as e,q as X,v as I,g as Y,R as ee,e as te,m as re,h as M,f as T,i as w,A as z,P as D,w as oe,x as ae,y as se,z as ne,F as ie,D as le,E as ce,G as de,c as P,H as ue,u as O,b as E,B as y,L as pe,a as me,I as fe,J as S}from"./index-DQJT4g5E.js";import{B as C}from"./bell-BJ0RGete.js";import{C as xe}from"./check-BsXBBUsE.js";import{m as j}from"./proxy-BIzXP1Nw.js";import{S as ge,B as he}from"./BottomNavigation-BUhWCQHl.js";import{O as ve}from"./OptimizedImage-DBzFcGB6.js";import{H as je,u as ye}from"./useFavorites-B22DN5Gh.js";import{S as Ne}from"./star-BhxkPCl1.js";import{C as be}from"./chevron-right-Dv7Xa5A7.js";import{u as Ce}from"./useEstablishmentsQuery-CK81FHQh.js";import{u as we}from"./useDebounce-rG93BeuF.js";import"./calendar-D8Y6luEC.js";import"./user-DyqSMMvV.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=Q("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);function Re(r){const t=Oe(r),a=i.forwardRef((s,o)=>{const{children:n,...c}=s,l=i.Children.toArray(n),m=l.find(Se);if(m){const f=m.props.children,u=l.map(x=>x===m?i.Children.count(f)>1?i.Children.only(null):i.isValidElement(f)?f.props.children:null:x);return e.jsx(t,{...c,ref:o,children:i.isValidElement(f)?i.cloneElement(f,void 0,u):null})}return e.jsx(t,{...c,ref:o,children:n})});return a.displayName=`${r}.Slot`,a}function Oe(r){const t=i.forwardRef((a,s)=>{const{children:o,...n}=a;if(i.isValidElement(o)){const c=ke(o),l=Ee(n,o.props);return o.type!==i.Fragment&&(l.ref=s?X(s,c):c),i.cloneElement(o,l)}return i.Children.count(o)>1?i.Children.only(null):null});return t.displayName=`${r}.SlotClone`,t}var Ae=Symbol("radix.slottable");function Se(r){return i.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===Ae}function Ee(r,t){const a={...t};for(const s in t){const o=r[s],n=t[s];/^on[A-Z]/.test(s)?o&&n?a[s]=(...l)=>{const m=n(...l);return o(...l),m}:o&&(a[s]=o):s==="style"?a[s]={...o,...n}:s==="className"&&(a[s]=[o,n].filter(Boolean).join(" "))}return{...r,...a}}function ke(r){var s,o;let t=(s=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:s.get,a=t&&"isReactWarning"in t&&t.isReactWarning;return a?r.ref:(t=(o=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:o.get,a=t&&"isReactWarning"in t&&t.isReactWarning,a?r.props.ref:r.props.ref||r.ref)}var A="Popover",[B]=te(A,[I]),R=I(),[_e,h]=B(A),L=r=>{const{__scopePopover:t,children:a,open:s,defaultOpen:o,onOpenChange:n,modal:c=!1}=r,l=R(t),m=i.useRef(null),[f,u]=i.useState(!1),[x,d]=Y({prop:s,defaultProp:o??!1,onChange:n,caller:A});return e.jsx(ee,{...l,children:e.jsx(_e,{scope:t,contentId:re(),triggerRef:m,open:x,onOpenChange:d,onOpenToggle:i.useCallback(()=>d(v=>!v),[d]),hasCustomAnchor:f,onCustomAnchorAdd:i.useCallback(()=>u(!0),[]),onCustomAnchorRemove:i.useCallback(()=>u(!1),[]),modal:c,children:a})})};L.displayName=A;var $="PopoverAnchor",Fe=i.forwardRef((r,t)=>{const{__scopePopover:a,...s}=r,o=h($,a),n=R(a),{onCustomAnchorAdd:c,onCustomAnchorRemove:l}=o;return i.useEffect(()=>(c(),()=>l()),[c,l]),e.jsx(z,{...n,...s,ref:t})});Fe.displayName=$;var U="PopoverTrigger",H=i.forwardRef((r,t)=>{const{__scopePopover:a,...s}=r,o=h(U,a),n=R(a),c=M(t,o.triggerRef),l=e.jsx(T.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":Z(o.open),...s,ref:c,onClick:w(r.onClick,o.onOpenToggle)});return o.hasCustomAnchor?l:e.jsx(z,{asChild:!0,...n,children:l})});H.displayName=U;var k="PopoverPortal",[Ie,Me]=B(k,{forceMount:void 0}),V=r=>{const{__scopePopover:t,forceMount:a,children:s,container:o}=r,n=h(k,t);return e.jsx(Ie,{scope:t,forceMount:a,children:e.jsx(D,{present:a||n.open,children:e.jsx(oe,{asChild:!0,container:o,children:s})})})};V.displayName=k;var N="PopoverContent",W=i.forwardRef((r,t)=>{const a=Me(N,r.__scopePopover),{forceMount:s=a.forceMount,...o}=r,n=h(N,r.__scopePopover);return e.jsx(D,{present:s||n.open,children:n.modal?e.jsx(ze,{...o,ref:t}):e.jsx(De,{...o,ref:t})})});W.displayName=N;var Te=Re("PopoverContent.RemoveScroll"),ze=i.forwardRef((r,t)=>{const a=h(N,r.__scopePopover),s=i.useRef(null),o=M(t,s),n=i.useRef(!1);return i.useEffect(()=>{const c=s.current;if(c)return ae(c)},[]),e.jsx(se,{as:Te,allowPinchZoom:!0,children:e.jsx(G,{...r,ref:o,trapFocus:a.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:w(r.onCloseAutoFocus,c=>{var l;c.preventDefault(),n.current||(l=a.triggerRef.current)==null||l.focus()}),onPointerDownOutside:w(r.onPointerDownOutside,c=>{const l=c.detail.originalEvent,m=l.button===0&&l.ctrlKey===!0,f=l.button===2||m;n.current=f},{checkForDefaultPrevented:!1}),onFocusOutside:w(r.onFocusOutside,c=>c.preventDefault(),{checkForDefaultPrevented:!1})})})}),De=i.forwardRef((r,t)=>{const a=h(N,r.__scopePopover),s=i.useRef(!1),o=i.useRef(!1);return e.jsx(G,{...r,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:n=>{var c,l;(c=r.onCloseAutoFocus)==null||c.call(r,n),n.defaultPrevented||(s.current||(l=a.triggerRef.current)==null||l.focus(),n.preventDefault()),s.current=!1,o.current=!1},onInteractOutside:n=>{var m,f;(m=r.onInteractOutside)==null||m.call(r,n),n.defaultPrevented||(s.current=!0,n.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const c=n.target;((f=a.triggerRef.current)==null?void 0:f.contains(c))&&n.preventDefault(),n.detail.originalEvent.type==="focusin"&&o.current&&n.preventDefault()}})}),G=i.forwardRef((r,t)=>{const{__scopePopover:a,trapFocus:s,onOpenAutoFocus:o,onCloseAutoFocus:n,disableOutsidePointerEvents:c,onEscapeKeyDown:l,onPointerDownOutside:m,onFocusOutside:f,onInteractOutside:u,...x}=r,d=h(N,a),v=R(a);return ne(),e.jsx(ie,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:o,onUnmountAutoFocus:n,children:e.jsx(le,{asChild:!0,disableOutsidePointerEvents:c,onInteractOutside:u,onEscapeKeyDown:l,onPointerDownOutside:m,onFocusOutside:f,onDismiss:()=>d.onOpenChange(!1),children:e.jsx(ce,{"data-state":Z(d.open),role:"dialog",id:d.contentId,...v,...x,ref:t,style:{...x.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),K="PopoverClose",Be=i.forwardRef((r,t)=>{const{__scopePopover:a,...s}=r,o=h(K,a);return e.jsx(T.button,{type:"button",...s,ref:t,onClick:w(r.onClick,()=>o.onOpenChange(!1))})});Be.displayName=K;var Le="PopoverArrow",$e=i.forwardRef((r,t)=>{const{__scopePopover:a,...s}=r,o=R(a);return e.jsx(de,{...o,...s,ref:t})});$e.displayName=Le;function Z(r){return r?"open":"closed"}var Ue=L,He=H,Ve=V,q=W;const We=Ue,Ge=He,J=i.forwardRef(({className:r,align:t="center",sideOffset:a=4,...s},o)=>e.jsx(Ve,{children:e.jsx(q,{ref:o,align:t,sideOffset:a,className:P("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...s})}));J.displayName=q.displayName;function Ke(){const{notifications:r,unreadCount:t,markAsRead:a,markAllAsRead:s,loading:o,error:n,refetch:c}=ue(),[l,m]=i.useState(!1),f=O(),{t:u}=E();i.useEffect(()=>{l&&console.log("游댒 [NotificationsDropdown] Opened - State:",{notificationsCount:r.length,unreadCount:t,loading:o,error:n,notifications:r.map(d=>({id:d.id,title:d.title,read:d.read,type:d.type}))})},[l,r,t,o,n]);const x=d=>{d.read||a(d.id),m(!1),f(`/notifications/${d.id}`)};return i.useEffect(()=>{l&&c()},[l,c]),e.jsxs(We,{open:l,onOpenChange:m,children:[e.jsx(Ge,{asChild:!0,children:e.jsxs(y,{variant:"ghost",size:"icon",className:"text-muted-foreground relative",children:[e.jsx(C,{className:"w-5 h-5"}),t>0&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 min-w-[18px] h-[18px] px-1 bg-primary text-primary-foreground text-xs font-bold rounded-full flex items-center justify-center",children:t})]})}),e.jsxs(J,{className:"w-80 p-0",align:"end",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:u("notifications.title")}),t>0&&e.jsxs(y,{variant:"ghost",size:"sm",onClick:s,className:"text-xs text-primary hover:text-primary/80",children:[e.jsx(xe,{className:"w-3 h-3 mr-1"}),u("notifications.markAllRead")]})]}),e.jsx("div",{className:"max-h-80 overflow-y-auto",children:o?e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[e.jsx(C,{className:"w-10 h-10 mx-auto mb-2 opacity-50 animate-pulse"}),e.jsx("p",{children:u("common.loading")||"Cargando..."})]}):n?e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[e.jsx(C,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),e.jsxs("p",{className:"text-red-500 text-sm",children:["Error: ",n]})]}):r.length===0?e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[e.jsx(C,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:u("notifications.noNotifications")||"No tienes notificaciones"})]}):r.slice(0,10).map(d=>e.jsxs("button",{onClick:()=>x(d),className:P("w-full flex items-start gap-3 p-4 text-left transition-colors hover:bg-gray-50/50 border-b border-gray-100 last:border-0",d.read&&"opacity-70"),children:[e.jsx("div",{className:"flex-shrink-0 pt-1",children:d.read?e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-300"}):e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("p",{className:P("font-semibold text-[15px]",d.read?"text-gray-600":"text-gray-900"),children:d.title})}),e.jsx("p",{className:P("text-sm line-clamp-2 mb-1 leading-relaxed",d.read?"text-gray-500":"text-gray-600"),children:d.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:d.time})]})]},d.id))}),e.jsx("div",{className:"p-3 border-t border-border",children:e.jsx(pe,{to:"/notifications",onClick:()=>m(!1),children:e.jsx(y,{variant:"ghost",size:"sm",className:"w-full text-primary",children:u("notifications.viewAll")})})})]})]})}function Ze(){const r=O(),[t,a]=i.useState(!1);return i.useEffect(()=>{const s=setTimeout(()=>{a(!0),setTimeout(()=>a(!1),1500)},2e3),o=setInterval(()=>{a(!0),setTimeout(()=>a(!1),1500)},1e4);return()=>{clearInterval(o),clearTimeout(s)}},[]),e.jsx("header",{className:"sticky top-0 z-40 bg-card/80 backdrop-blur-md border-b border-border",style:{paddingTop:"env(safe-area-inset-top)"},children:e.jsxs("div",{className:"flex items-center justify-between h-16 px-4 max-w-lg mx-auto relative",children:[e.jsxs(j.div,{className:"relative",animate:t?{x:[-2,2,-2,2,-2,2,0],scale:[1,1.05,1,1.05,1]}:{},transition:{duration:.5,ease:"easeInOut"},children:[e.jsx("h1",{className:"text-xl font-bold text-foreground",children:"M칤 Turnow"}),e.jsx(j.div,{className:"absolute -top-1 -right-6",animate:t?{rotate:[-15,15,-15,15,-15,15,0],scale:[1,1.2,1,1.2,1]}:{scale:1},transition:{duration:.6,ease:"easeInOut"},children:e.jsxs(j.div,{className:"relative",animate:t?{opacity:1}:{opacity:.3},children:[e.jsx(C,{className:`w-5 h-5 ${t?"text-orange-500":"text-gray-400"}`,strokeWidth:2.5,fill:t?"currentColor":"none"}),t&&e.jsx(j.div,{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-orange-500 rounded-full",animate:{scale:[0,1.3,1],opacity:[0,1,1]},transition:{duration:.3}}),t&&e.jsxs(e.Fragment,{children:[e.jsx(j.div,{className:"absolute inset-0 rounded-full border-2 border-orange-500",initial:{scale:1,opacity:.8},animate:{scale:[1,2],opacity:[.8,0]},transition:{duration:1,ease:"easeOut"}}),e.jsx(j.div,{className:"absolute inset-0 rounded-full border-2 border-orange-400",initial:{scale:1,opacity:.6},animate:{scale:[1,2.5],opacity:[.6,0]},transition:{duration:1.2,delay:.2,ease:"easeOut"}})]})]})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{variant:"ghost",size:"icon",onClick:()=>r("/search"),className:"text-muted-foreground",children:e.jsx(ge,{className:"w-5 h-5"})}),e.jsx(Ke,{})]})]})})}const qe=i.memo(function({business:t,onToggleFavorite:a}){const s=O(),{t:o}=E(),n=()=>{s(`/business/${t.id}`)},c=u=>{u.stopPropagation(),a==null||a(t.id)},l=u=>u.toLocaleString(),f=(u=>{if(!u)return"";const x=u.replace(/_/g,"-"),d=o(`categories.${x}`);return d&&d!==`categories.${x}`?d:""})(t.category);return e.jsxs("div",{onClick:n,className:"flex-shrink-0 w-[180px] cursor-pointer group",children:[e.jsxs("div",{className:"relative",children:[t.coverImageUrl||t.imageUrl?e.jsx(ve,{src:t.coverImageUrl||t.imageUrl||"",alt:t.name,loading:"lazy",className:"w-full aspect-[16/11] rounded-xl object-cover transition-transform duration-300 group-hover:scale-105"}):e.jsx("div",{className:"w-full aspect-[16/11] rounded-xl flex items-center justify-center bg-gradient-to-br from-primary/20 to-primary/5",children:e.jsx("span",{className:"text-4xl font-bold text-primary/30",children:t.name.charAt(0).toUpperCase()})}),e.jsx("button",{onClick:c,className:"absolute top-2.5 right-2.5 w-8 h-8 rounded-full bg-white/90 backdrop-blur-sm flex items-center justify-center transition-all duration-200 hover:bg-white hover:scale-110 shadow-sm z-10 opacity-0 group-hover:opacity-100",children:e.jsx(je,{className:P("w-4 h-4 transition-colors",t.isFavorite?"fill-red-500 text-red-500":"text-gray-400")})})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("h3",{className:"font-semibold text-[15px] text-gray-900 leading-tight line-clamp-2",children:t.name}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ne,{className:"w-4 h-4 fill-yellow-400 text-yellow-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:t.rating.toFixed(1)}),t.reviewCount>0&&e.jsxs("span",{className:"text-sm text-gray-600 font-normal",children:["(",l(t.reviewCount),")"]})]}),t.address&&e.jsx("p",{className:"text-xs text-gray-600 leading-relaxed line-clamp-1",children:t.address}),f&&e.jsx("p",{className:"text-xs text-gray-600 leading-relaxed",children:f})]})]})}),F=i.memo(function({title:t,businesses:a,onToggleFavorite:s,showViewAll:o=!1,onViewAll:n,isFirstSection:c=!1}){return a.length===0?null:e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between px-4",children:[e.jsx("h2",{className:"text-lg font-bold text-foreground",children:t}),o&&e.jsxs("button",{onClick:n,className:"flex items-center gap-1 text-sm text-primary font-medium hover:underline",children:["Ver todo",e.jsx(be,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"overflow-x-auto pb-3 scrollbar-hide",style:{WebkitOverflowScrolling:"touch",scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"flex gap-4 snap-x snap-mandatory",style:{paddingLeft:"max(env(safe-area-inset-left, 0px), 1rem)",paddingRight:"max(env(safe-area-inset-right, 0px), 1rem)"},children:a.map(l=>e.jsx("div",{className:"snap-start",children:e.jsx(qe,{business:l,onToggleFavorite:s})},l.id))})})]})}),Je={barberia:"Barber칤a",barber:"Barber칤a",salon:"Sal칩n de Belleza","hair-salon":"Sal칩n de Belleza",spa:"Spa & Bienestar","spa-sauna":"Spa & Bienestar",nails:"U침as",beauty:"Belleza","beauty-salon":"Belleza",massage:"Masajes",medspa:"Med Spa",general:"Establecimientos",other:"Otros"},dt=()=>{const r=O(),{t}=E(),{user:a,isGuest:s}=me(),{data:o=[],isLoading:n,error:c}=Ce(),{isFavorite:l,toggleFavorite:m}=ye(),f=we(m,500),u=i.useMemo(()=>o.map(p=>{const b=(p.category||p.primary_category||"general").replace(/_/g,"-");return{id:p.id,name:p.name,rating:p.rating||0,reviewCount:p.review_count||0,address:p.address||void 0,category:b,imageUrl:p.main_image||"",coverImageUrl:p.cover_image_url||void 0,logoUrl:p.logo_url||void 0,isFavorite:l(p.id)}}),[o,l]),x=i.useMemo(()=>{const p={};return u.forEach(g=>{var _;const b=((_=g.category)==null?void 0:_.toLowerCase())||"general";p[b]||(p[b]=[]),p[b].push(g)}),p},[u]),d=i.useMemo(()=>Object.keys(x).sort((p,g)=>x[g].length-x[p].length),[x]),v=async p=>{if(!a&&!s){S({title:t("common.error"),description:"Debes iniciar sesi칩n para guardar favoritos",variant:"destructive"});return}if(s){S({title:t("common.error"),description:"Los invitados no pueden guardar favoritos. Crea una cuenta.",variant:"destructive"});return}const{error:g}=await f(p);g&&S({title:t("common.error"),description:"No se pudo actualizar favoritos",variant:"destructive"})};return i.useEffect(()=>()=>{},[]),n?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(fe,{className:"w-8 h-8 animate-spin text-primary"})}):c&&u.length===0?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-destructive mb-4",children:[t("common.error"),": ",c]}),e.jsx(y,{onClick:()=>window.location.reload(),children:t("common.retry")})]})}):e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx(Ze,{}),e.jsxs("main",{className:"py-5 space-y-8",style:{paddingInline:"0",boxSizing:"border-box"},children:[u.length>0&&e.jsx(F,{title:t("home.allEstablishments"),businesses:u,onToggleFavorite:v,isFirstSection:!0}),d.map(p=>{const g=x[p];return g.length===0||d.length===1&&p==="general"?null:e.jsx(F,{title:Je[p]||p,businesses:g,onToggleFavorite:v},p)}),u.length===0&&e.jsx("div",{className:"text-center py-12 px-4 animate-fade-in",children:e.jsx("p",{className:"text-muted-foreground",children:t("common.noResults")})})]}),e.jsx("div",{className:"fixed left-1/2 -translate-x-1/2 z-40",style:{bottom:"calc(clamp(4rem, 12vw, 4.5rem) + 2.5rem + 0.5rem + env(safe-area-inset-bottom))"},children:e.jsxs(y,{size:"default",className:"rounded-full shadow-elevated gap-2",onClick:()=>r("/map"),children:[e.jsx(Pe,{className:"w-4 h-4"}),t("home.map")]})}),e.jsx(he,{})]})};export{dt as default};
