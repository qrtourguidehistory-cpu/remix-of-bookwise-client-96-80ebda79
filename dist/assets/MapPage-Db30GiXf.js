import{u as L,b as z,r as t,x as N,j as e,B as A}from"./index-YNrFhYI6.js";import{B as R}from"./BottomNavigation-11LRiB19.js";import{A as T}from"./arrow-left-C99VgAQq.js";import{M as v}from"./map-pin-BDvPjSKo.js";import{S as C,a as P,D as _}from"./sparkles-uTSc4BbA.js";import{S as D}from"./scissors-D3kgIV1H.js";import"./search-DoTgwh_l.js";import"./calendar-DkL1xBqi.js";import"./user-CzezY9Wt.js";const b=[{id:"all",label:"Todos",icon:C,color:"#8B5CF6"},{id:"barber",label:"Barbería",icon:D,color:"#F59E0B"},{id:"nails",label:"Uñas",icon:C,color:"#EC4899"},{id:"spa",label:"Spa",icon:P,color:"#06B6D4"},{id:"fitness",label:"Fitness",icon:_,color:"#10B981"}],F=l=>l&&{barberia:"barber",barber:"barber","hair-salon":"barber",peluqueria:"barber",nails:"nails",uñas:"nails",spa:"spa","spa-sauna":"spa",massage:"spa",fitness:"fitness","fitness-recovery":"fitness",gym:"fitness"}[l.toLowerCase()]||"other",Q=()=>{const l=L(),{t:x}=z(),p=t.useRef(null),E=t.useRef(null),[c,S]=t.useState("all"),[u,M]=t.useState([]),[h,d]=t.useState(!0),[y,m]=t.useState(null),[K]=t.useState(()=>""),w=t.useCallback(async()=>{const{data:s,error:o}=await N.from("businesses").select("id, business_name, primary_category, latitude, longitude").eq("is_public",!0).eq("is_active",!0).not("latitude","is",null).not("longitude","is",null);return o?(console.error("Error fetching businesses:",o),[]):(s||[]).map(a=>({id:a.id,name:a.business_name||"Sin nombre",category:F(a.primary_category),lat:Number(a.latitude),lng:Number(a.longitude),marker:null}))},[]),j=t.useCallback(async()=>{try{const{data:s,error:o}=await N.functions.invoke("get-google-maps-key");return o?(console.error("Error fetching API key:",o),""):(s==null?void 0:s.apiKey)||""}catch(s){return console.error("Error:",s),""}},[]);return t.useEffect(()=>{const s=async()=>{const a=await j();if(!a){m("API key de Google Maps no configurada."),d(!1);return}if(!window.google||!window.google.maps){const r=document.createElement("script");r.src=`https://maps.googleapis.com/maps/api/js?key=${a}`,r.async=!0,r.defer=!0,r.onload=()=>o(),r.onerror=()=>{m("Error cargando Google Maps. Verifica la API key."),d(!1)},document.head.appendChild(r)}else o()},o=async()=>{if(p.current)try{const a={lat:19.7934,lng:-70.6884},r=new window.google.maps.Map(p.current,{center:a,zoom:12,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}],mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1});E.current=r;const k=await w();k.length===0&&m("No hay establecimientos con ubicación configurada aún.");const f=k.map(n=>{const i=b.find(I=>I.id===n.category)||b[0],g=new window.google.maps.Marker({position:{lat:n.lat,lng:n.lng},map:r,title:n.name,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:10,fillColor:i.color,fillOpacity:1,strokeColor:"#ffffff",strokeWeight:2}}),B=new window.google.maps.InfoWindow({content:`
              <div style="padding: 8px;">
                <strong>${n.name}</strong><br/>
                <span style="color: #666; font-size: 12px;">${i.label}</span>
              </div>
            `});return g.addListener("click",()=>{B.open(r,g)}),{...n,marker:g}});if(M(f),f.length>0){const n=new window.google.maps.LatLngBounds;f.forEach(i=>{n.extend({lat:i.lat,lng:i.lng})}),r.fitBounds(n)}d(!1)}catch(a){console.error("Map initialization error:",a),m("Error inicializando el mapa."),d(!1)}};return s(),()=>{u.forEach(a=>{var r;return(r=a.marker)==null?void 0:r.setMap(null)})}},[w,j]),t.useEffect(()=>{u.forEach(s=>{s.marker&&(c==="all"?s.marker.setVisible(!0):s.marker.setVisible(s.category===c))})},[c,u]),e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-50 bg-card border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-4 h-14 px-4 max-w-lg mx-auto",children:[e.jsx(A,{variant:"ghost",size:"icon",onClick:()=>l(-1),children:e.jsx(T,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5 text-primary"}),e.jsx("h1",{className:"font-semibold text-foreground",children:x("map.title")})]})]})}),e.jsx("div",{className:"sticky top-14 z-40 bg-card border-b border-border",children:e.jsx("div",{className:"flex gap-2 px-4 py-3 overflow-x-auto no-scrollbar max-w-lg mx-auto",children:b.map(s=>{const o=s.icon,a=c===s.id;return e.jsxs("button",{onClick:()=>S(s.id),className:`flex items-center gap-2 px-4 py-2 rounded-full whitespace-nowrap transition-all ${a?"bg-primary text-primary-foreground":"bg-secondary text-foreground hover:bg-secondary/80"}`,children:[e.jsx(o,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:s.label})]},s.id)})})}),e.jsxs("main",{className:"relative h-[calc(100vh-56px-60px-80px)]",children:[h&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-background",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Cargando mapa..."})]})}),y&&!h&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-background p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(v,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:y}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Los establecimientos necesitan tener coordenadas (latitud/longitud) configuradas."})]})}),e.jsx("div",{ref:p,className:"w-full h-full",style:{minHeight:"400px"}})]}),e.jsx(R,{})]})};export{Q as default};
