import{r as u,j as s,c as R,u as I,o as P,a as A,b as E,B as S,n as w}from"./index-BMNWyqXE.js";import{m as g}from"./proxy-Ru_3edXT.js";import{A as L}from"./arrow-left-BiC-gsyl.js";const T=({length:n=4,value:c,onChange:h,onComplete:x,disabled:d=!1,className:f})=>{const o=u.useRef([]),[b,r]=u.useState(0);u.useEffect(()=>{var e;(e=o.current[0])==null||e.focus()},[]),u.useEffect(()=>{c.length===n&&x&&x(c)},[c,n,x]);const j=(e,t)=>{var m;if(!/^\d*$/.test(t))return;const a=c.split("");a[e]=t.slice(-1);const l=a.join("").slice(0,n);h(l),t&&e<n-1&&((m=o.current[e+1])==null||m.focus(),r(e+1))},y=(e,t)=>{var a,l,m;if(t.key==="Backspace"){if(t.preventDefault(),c[e]){const p=c.split("");p[e]="",h(p.join(""))}else if(e>0){(a=o.current[e-1])==null||a.focus(),r(e-1);const p=c.split("");p[e-1]="",h(p.join(""))}}else t.key==="ArrowLeft"&&e>0?((l=o.current[e-1])==null||l.focus(),r(e-1)):t.key==="ArrowRight"&&e<n-1&&((m=o.current[e+1])==null||m.focus(),r(e+1))},v=e=>{var l;e.preventDefault();const t=e.clipboardData.getData("text").replace(/\D/g,"").slice(0,n);h(t);const a=Math.min(t.length,n-1);(l=o.current[a])==null||l.focus(),r(a)},N=e=>{var t;r(e),(t=o.current[e])==null||t.select()};return s.jsx("div",{className:R("flex gap-3 justify-center",f),children:Array.from({length:n}).map((e,t)=>s.jsx("input",{ref:a=>o.current[t]=a,type:"text",inputMode:"numeric",autoComplete:"one-time-code",maxLength:1,value:c[t]||"",onChange:a=>j(t,a.target.value),onKeyDown:a=>y(t,a),onPaste:v,onFocus:()=>N(t),disabled:d,className:R("w-16 h-16 text-center text-2xl font-semibold rounded-xl border-2 transition-all duration-200","bg-card text-foreground","focus:outline-none focus:ring-0",b===t?"border-primary ring-2 ring-primary/20":"border-border",d&&"opacity-50 cursor-not-allowed")},t))})},$=()=>{var D;const n=I(),c=P(),{verifyOTP:h,signInWithPhone:x}=A(),{t:d}=E(),f=((D=c.state)==null?void 0:D.phone)||"",[o,b]=u.useState(""),[r,j]=u.useState(!1),[y,v]=u.useState(30),[N,e]=u.useState(!1);u.useEffect(()=>{if(!f){n("/auth");return}if(y>0){const i=setTimeout(()=>v(y-1),1e3);return()=>clearTimeout(i)}else e(!0)},[y,f,n]);const t=async i=>{j(!0);const{error:k}=await h(f,i);k?(w.error(k.message||"Invalid verification code"),b(""),j(!1)):(w.success("Phone verified successfully!"),n("/"))},a=async()=>{if(!N)return;e(!1),v(30);const{error:i}=await x(f);i?(w.error(i.message||"Failed to resend code"),e(!0)):w.success("Verification code sent!")},l=()=>{n("/auth")},m=()=>{n("/auth")},p=i=>{if(i.length>=10){const C=i.replace(/\D/g,"").slice(-10);return`(${C.slice(0,3)}) ${C.slice(3,6)}-${C.slice(6)}`}return i};return s.jsxs(g.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},transition:{duration:.3},className:"min-h-screen bg-background flex flex-col",children:[s.jsx("div",{className:"flex items-center p-4",children:s.jsx("button",{onClick:l,className:"p-2 -ml-2 rounded-full hover:bg-accent transition-colors",children:s.jsx(L,{className:"h-6 w-6 text-foreground"})})}),s.jsxs("div",{className:"flex-1 px-6 pb-8",children:[s.jsxs(g.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1,duration:.4},className:"text-center mb-8",children:[s.jsx("h1",{className:"text-foreground text-2xl font-bold mb-2",children:d("auth.otp.title","Enter the 4-digit code sent to")}),s.jsx("p",{className:"text-foreground font-medium text-lg",children:p(f)}),s.jsx("button",{onClick:m,className:"text-primary mt-2 hover:underline",children:d("auth.otp.changeNumber","Changed your mobile number?")})]}),s.jsx(g.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.2,duration:.4},className:"mb-8",children:s.jsx(T,{value:o,onChange:b,onComplete:t,disabled:r})}),s.jsx(g.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3,duration:.4},className:"text-center",children:N?s.jsx(S,{variant:"ghost",onClick:a,className:"text-primary hover:text-primary/80",children:d("auth.otp.resend","Resend code via SMS")}):s.jsxs("p",{className:"text-muted-foreground",children:[d("auth.otp.resendIn","Resend in")," 0:",y.toString().padStart(2,"0")]})}),r&&s.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},className:"flex justify-center mt-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})]}),s.jsx("div",{className:"px-6 pb-8",children:s.jsx(S,{onClick:()=>t(o),disabled:o.length!==4||r,className:"w-full h-14 text-lg font-semibold rounded-xl",children:r?s.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary-foreground"}):d("common.confirm","Confirm")})})]})};export{$ as default};
