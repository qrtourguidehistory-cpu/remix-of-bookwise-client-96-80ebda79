import{v as J,r as l,j as e,y as Q,z as _,p as q,R as X,e as Y,t as ee,d as F,P as M,g as C,A as z,f as B,E as te,F as re,G as oe,H as ae,I as se,J as ne,K as ie,L as le,c as N,M as ce,u as P,b as O,B as v,N as de,a as pe,O as ue,Q as A}from"./index-CqvD_sCs.js";import{B as w}from"./bell-C3L2r_CU.js";import{C as me}from"./check-bKe3EnGw.js";import{S as fe}from"./search-DEDadUJR.js";import{B as xe}from"./BottomNavigation-c2SF0zwj.js";import{H as he,u as ge}from"./useFavorites-BS_v5tpP.js";import{S as ve}from"./star-CoiCNFg2.js";import{C as je}from"./chevron-right-Cz72PGWF.js";import{u as ye}from"./useEstablishments-D3n_NSSY.js";import"./calendar-BL1Td8cM.js";import"./user-BMVkzAar.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=J("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);function Ne(r){const t=be(r),a=l.forwardRef((s,o)=>{const{children:n,...c}=s,i=l.Children.toArray(n),f=i.find(Pe);if(f){const u=f.props.children,m=i.map(x=>x===f?l.Children.count(u)>1?l.Children.only(null):l.isValidElement(u)?u.props.children:null:x);return e.jsx(t,{...c,ref:o,children:l.isValidElement(u)?l.cloneElement(u,void 0,m):null})}return e.jsx(t,{...c,ref:o,children:n})});return a.displayName=`${r}.Slot`,a}function be(r){const t=l.forwardRef((a,s)=>{const{children:o,...n}=a;if(l.isValidElement(o)){const c=Ae(o),i=Re(n,o.props);return o.type!==l.Fragment&&(i.ref=s?Q(s,c):c),l.cloneElement(o,i)}return l.Children.count(o)>1?l.Children.only(null):null});return t.displayName=`${r}.SlotClone`,t}var we=Symbol("radix.slottable");function Pe(r){return l.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===we}function Re(r,t){const a={...t};for(const s in t){const o=r[s],n=t[s];/^on[A-Z]/.test(s)?o&&n?a[s]=(...i)=>{const f=n(...i);return o(...i),f}:o&&(a[s]=o):s==="style"?a[s]={...o,...n}:s==="className"&&(a[s]=[o,n].filter(Boolean).join(" "))}return{...r,...a}}function Ae(r){var s,o;let t=(s=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:s.get,a=t&&"isReactWarning"in t&&t.isReactWarning;return a?r.ref:(t=(o=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:o.get,a=t&&"isReactWarning"in t&&t.isReactWarning,a?r.props.ref:r.props.ref||r.ref)}var R="Popover",[I]=Y(R,[_]),b=_(),[Oe,g]=I(R),D=r=>{const{__scopePopover:t,children:a,open:s,defaultOpen:o,onOpenChange:n,modal:c=!1}=r,i=b(t),f=l.useRef(null),[u,m]=l.useState(!1),[x,d]=q({prop:s,defaultProp:o??!1,onChange:n,caller:R});return e.jsx(X,{...i,children:e.jsx(Oe,{scope:t,contentId:ee(),triggerRef:f,open:x,onOpenChange:d,onOpenToggle:l.useCallback(()=>d(p=>!p),[d]),hasCustomAnchor:u,onCustomAnchorAdd:l.useCallback(()=>m(!0),[]),onCustomAnchorRemove:l.useCallback(()=>m(!1),[]),modal:c,children:a})})};D.displayName=R;var L="PopoverAnchor",Se=l.forwardRef((r,t)=>{const{__scopePopover:a,...s}=r,o=g(L,a),n=b(a),{onCustomAnchorAdd:c,onCustomAnchorRemove:i}=o;return l.useEffect(()=>(c(),()=>i()),[c,i]),e.jsx(z,{...n,...s,ref:t})});Se.displayName=L;var T="PopoverTrigger",$=l.forwardRef((r,t)=>{const{__scopePopover:a,...s}=r,o=g(T,a),n=b(a),c=F(t,o.triggerRef),i=e.jsx(M.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":G(o.open),...s,ref:c,onClick:C(r.onClick,o.onOpenToggle)});return o.hasCustomAnchor?i:e.jsx(z,{asChild:!0,...n,children:i})});$.displayName=T;var S="PopoverPortal",[ke,Ee]=I(S,{forceMount:void 0}),H=r=>{const{__scopePopover:t,forceMount:a,children:s,container:o}=r,n=g(S,t);return e.jsx(ke,{scope:t,forceMount:a,children:e.jsx(B,{present:a||n.open,children:e.jsx(te,{asChild:!0,container:o,children:s})})})};H.displayName=S;var j="PopoverContent",V=l.forwardRef((r,t)=>{const a=Ee(j,r.__scopePopover),{forceMount:s=a.forceMount,...o}=r,n=g(j,r.__scopePopover);return e.jsx(B,{present:s||n.open,children:n.modal?e.jsx(Fe,{...o,ref:t}):e.jsx(Me,{...o,ref:t})})});V.displayName=j;var _e=Ne("PopoverContent.RemoveScroll"),Fe=l.forwardRef((r,t)=>{const a=g(j,r.__scopePopover),s=l.useRef(null),o=F(t,s),n=l.useRef(!1);return l.useEffect(()=>{const c=s.current;if(c)return re(c)},[]),e.jsx(oe,{as:_e,allowPinchZoom:!0,children:e.jsx(W,{...r,ref:o,trapFocus:a.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:C(r.onCloseAutoFocus,c=>{var i;c.preventDefault(),n.current||(i=a.triggerRef.current)==null||i.focus()}),onPointerDownOutside:C(r.onPointerDownOutside,c=>{const i=c.detail.originalEvent,f=i.button===0&&i.ctrlKey===!0,u=i.button===2||f;n.current=u},{checkForDefaultPrevented:!1}),onFocusOutside:C(r.onFocusOutside,c=>c.preventDefault(),{checkForDefaultPrevented:!1})})})}),Me=l.forwardRef((r,t)=>{const a=g(j,r.__scopePopover),s=l.useRef(!1),o=l.useRef(!1);return e.jsx(W,{...r,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:n=>{var c,i;(c=r.onCloseAutoFocus)==null||c.call(r,n),n.defaultPrevented||(s.current||(i=a.triggerRef.current)==null||i.focus(),n.preventDefault()),s.current=!1,o.current=!1},onInteractOutside:n=>{var f,u;(f=r.onInteractOutside)==null||f.call(r,n),n.defaultPrevented||(s.current=!0,n.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const c=n.target;((u=a.triggerRef.current)==null?void 0:u.contains(c))&&n.preventDefault(),n.detail.originalEvent.type==="focusin"&&o.current&&n.preventDefault()}})}),W=l.forwardRef((r,t)=>{const{__scopePopover:a,trapFocus:s,onOpenAutoFocus:o,onCloseAutoFocus:n,disableOutsidePointerEvents:c,onEscapeKeyDown:i,onPointerDownOutside:f,onFocusOutside:u,onInteractOutside:m,...x}=r,d=g(j,a),p=b(a);return ae(),e.jsx(se,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:o,onUnmountAutoFocus:n,children:e.jsx(ne,{asChild:!0,disableOutsidePointerEvents:c,onInteractOutside:m,onEscapeKeyDown:i,onPointerDownOutside:f,onFocusOutside:u,onDismiss:()=>d.onOpenChange(!1),children:e.jsx(ie,{"data-state":G(d.open),role:"dialog",id:d.contentId,...p,...x,ref:t,style:{...x.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),U="PopoverClose",ze=l.forwardRef((r,t)=>{const{__scopePopover:a,...s}=r,o=g(U,a);return e.jsx(M.button,{type:"button",...s,ref:t,onClick:C(r.onClick,()=>o.onOpenChange(!1))})});ze.displayName=U;var Be="PopoverArrow",Ie=l.forwardRef((r,t)=>{const{__scopePopover:a,...s}=r,o=b(a);return e.jsx(le,{...o,...s,ref:t})});Ie.displayName=Be;function G(r){return r?"open":"closed"}var De=D,Le=$,Te=H,K=V;const $e=De,He=Le,Z=l.forwardRef(({className:r,align:t="center",sideOffset:a=4,...s},o)=>e.jsx(Te,{children:e.jsx(K,{ref:o,align:t,sideOffset:a,className:N("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...s})}));Z.displayName=K.displayName;function Ve(){const{notifications:r,unreadCount:t,markAsRead:a,markAllAsRead:s,loading:o,error:n,refetch:c}=ce(),[i,f]=l.useState(!1),u=P(),{t:m}=O();l.useEffect(()=>{i&&console.log("游댒 [NotificationsDropdown] Opened - State:",{notificationsCount:r.length,unreadCount:t,loading:o,error:n,notifications:r.map(d=>({id:d.id,title:d.title,read:d.read,type:d.type}))})},[i,r,t,o,n]);const x=d=>{d.read||a(d.id),f(!1),u(`/notifications/${d.id}`)};return l.useEffect(()=>{i&&c()},[i,c]),e.jsxs($e,{open:i,onOpenChange:f,children:[e.jsx(He,{asChild:!0,children:e.jsxs(v,{variant:"ghost",size:"icon",className:"text-muted-foreground relative",children:[e.jsx(w,{className:"w-5 h-5"}),t>0&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 min-w-[18px] h-[18px] px-1 bg-primary text-primary-foreground text-xs font-bold rounded-full flex items-center justify-center",children:t})]})}),e.jsxs(Z,{className:"w-80 p-0",align:"end",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:m("notifications.title")}),t>0&&e.jsxs(v,{variant:"ghost",size:"sm",onClick:s,className:"text-xs text-primary hover:text-primary/80",children:[e.jsx(me,{className:"w-3 h-3 mr-1"}),m("notifications.markAllRead")]})]}),e.jsx("div",{className:"max-h-80 overflow-y-auto",children:o?e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[e.jsx(w,{className:"w-10 h-10 mx-auto mb-2 opacity-50 animate-pulse"}),e.jsx("p",{children:m("common.loading")||"Cargando..."})]}):n?e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[e.jsx(w,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),e.jsxs("p",{className:"text-red-500 text-sm",children:["Error: ",n]})]}):r.length===0?e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[e.jsx(w,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:m("notifications.noNotifications")||"No tienes notificaciones"})]}):r.slice(0,10).map(d=>e.jsxs("button",{onClick:()=>x(d),className:N("w-full flex items-start gap-3 p-4 text-left transition-colors hover:bg-gray-50/50 border-b border-gray-100 last:border-0",d.read&&"opacity-70"),children:[e.jsx("div",{className:"flex-shrink-0 pt-1",children:d.read?e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-300"}):e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("p",{className:N("font-semibold text-[15px]",d.read?"text-gray-600":"text-gray-900"),children:d.title})}),e.jsx("p",{className:N("text-sm line-clamp-2 mb-1 leading-relaxed",d.read?"text-gray-500":"text-gray-600"),children:d.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:d.time})]})]},d.id))}),e.jsx("div",{className:"p-3 border-t border-border",children:e.jsx(de,{to:"/notifications",onClick:()=>f(!1),children:e.jsx(v,{variant:"ghost",size:"sm",className:"w-full text-primary",children:m("notifications.viewAll")})})})]})]})}function We(){const r=P();return e.jsx("header",{className:"sticky top-0 z-40 bg-card/80 backdrop-blur-md border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between h-16 px-4 max-w-lg mx-auto",children:[e.jsx("h1",{className:"text-xl font-bold text-foreground",children:"Bookwise"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>r("/search"),className:"text-muted-foreground",children:e.jsx(fe,{className:"w-5 h-5"})}),e.jsx(Ve,{})]})]})})}const Ue=l.memo(function({business:t,onToggleFavorite:a}){const s=P(),{t:o}=O(),n=()=>{s(`/business/${t.id}`)},c=m=>{m.stopPropagation(),a==null||a(t.id)},i=m=>m.toLocaleString(),u=(m=>{if(!m)return"";const x=m.replace(/_/g,"-"),d=o(`categories.${x}`);return d&&d!==`categories.${x}`?d:""})(t.category);return e.jsxs("div",{onClick:n,className:"flex-shrink-0 w-[180px] cursor-pointer group",children:[e.jsxs("div",{className:"relative",children:[t.imageUrl?e.jsx("img",{src:t.imageUrl,alt:t.name,loading:"lazy",className:"w-full aspect-[16/11] rounded-xl object-cover transition-transform duration-300 group-hover:scale-105"}):e.jsx("div",{className:"w-full aspect-[16/11] rounded-xl flex items-center justify-center bg-gradient-to-br from-primary/20 to-primary/5",children:e.jsx("span",{className:"text-4xl font-bold text-primary/30",children:t.name.charAt(0).toUpperCase()})}),e.jsx("button",{onClick:c,className:"absolute top-2.5 right-2.5 w-8 h-8 rounded-full bg-white/90 backdrop-blur-sm flex items-center justify-center transition-all duration-200 hover:bg-white hover:scale-110 shadow-sm z-10 opacity-0 group-hover:opacity-100",children:e.jsx(he,{className:N("w-4 h-4 transition-colors",t.isFavorite?"fill-red-500 text-red-500":"text-gray-400")})})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("h3",{className:"font-semibold text-[15px] text-gray-900 leading-tight line-clamp-2",children:t.name}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ve,{className:"w-4 h-4 fill-yellow-400 text-yellow-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:t.rating.toFixed(1)}),t.reviewCount>0&&e.jsxs("span",{className:"text-sm text-gray-600 font-normal",children:["(",i(t.reviewCount),")"]})]}),t.address&&e.jsx("p",{className:"text-xs text-gray-600 leading-relaxed line-clamp-1",children:t.address}),u&&e.jsx("p",{className:"text-xs text-gray-600 leading-relaxed",children:u})]})]})}),E=l.memo(function({title:t,businesses:a,onToggleFavorite:s,showViewAll:o=!1,onViewAll:n,isFirstSection:c=!1}){return a.length===0?null:e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between px-4",children:[e.jsx("h2",{className:"text-lg font-bold text-foreground",children:t}),o&&e.jsxs("button",{onClick:n,className:"flex items-center gap-1 text-sm text-primary font-medium hover:underline",children:["Ver todo",e.jsx(je,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"overflow-x-auto pb-3 scrollbar-hide",style:{WebkitOverflowScrolling:"touch",scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"flex gap-4 snap-x snap-mandatory",style:{paddingLeft:"max(env(safe-area-inset-left, 0px), 1rem)",paddingRight:"max(env(safe-area-inset-right, 0px), 1rem)"},children:a.map(i=>e.jsx("div",{className:"snap-start",children:e.jsx(Ue,{business:i,onToggleFavorite:s})},i.id))})})]})}),Ge={barberia:"Barber칤a",barber:"Barber칤a",salon:"Sal칩n de Belleza","hair-salon":"Sal칩n de Belleza",spa:"Spa & Bienestar","spa-sauna":"Spa & Bienestar",nails:"U침as",beauty:"Belleza","beauty-salon":"Belleza",massage:"Masajes",medspa:"Med Spa",general:"Establecimientos",other:"Otros"},at=()=>{const r=P(),{t}=O(),{user:a,isGuest:s}=pe(),{establishments:o,loading:n,error:c}=ye(),{isFavorite:i,toggleFavorite:f}=ge(),u=l.useMemo(()=>o.map(p=>{const y=(p.category||p.primary_category||"general").replace(/_/g,"-");return{id:p.id,name:p.name,rating:p.rating||0,reviewCount:p.review_count||0,address:p.address||void 0,category:y,imageUrl:p.main_image||"",isFavorite:i(p.id)}}),[o,i]),m=l.useMemo(()=>{const p={};return u.forEach(h=>{var k;const y=((k=h.category)==null?void 0:k.toLowerCase())||"general";p[y]||(p[y]=[]),p[y].push(h)}),p},[u]),x=l.useMemo(()=>Object.keys(m).sort((p,h)=>m[h].length-m[p].length),[m]),d=async p=>{if(!a&&!s){A({title:t("common.error"),description:"Debes iniciar sesi칩n para guardar favoritos",variant:"destructive"});return}if(s){A({title:t("common.error"),description:"Los invitados no pueden guardar favoritos. Crea una cuenta.",variant:"destructive"});return}const{error:h}=await f(p);h&&A({title:t("common.error"),description:"No se pudo actualizar favoritos",variant:"destructive"})};return n?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(ue,{className:"w-8 h-8 animate-spin text-primary"})}):c?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-destructive mb-4",children:[t("common.error"),": ",c]}),e.jsx(v,{onClick:()=>window.location.reload(),children:t("common.retry")})]})}):e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx(We,{}),e.jsxs("main",{className:"py-5 space-y-8",style:{paddingInline:"0",boxSizing:"border-box"},children:[u.length>0&&e.jsx(E,{title:t("home.allEstablishments"),businesses:u,onToggleFavorite:d,isFirstSection:!0}),x.map(p=>{const h=m[p];return h.length===0||x.length===1&&p==="general"?null:e.jsx(E,{title:Ge[p]||p,businesses:h,onToggleFavorite:d},p)}),u.length===0&&e.jsx("div",{className:"text-center py-12 px-4 animate-fade-in",children:e.jsx("p",{className:"text-muted-foreground",children:t("common.noResults")})})]}),e.jsx("div",{className:"fixed left-1/2 -translate-x-1/2 z-40",style:{bottom:"calc(clamp(4rem, 12vw, 4.5rem) + 2.5rem + 0.5rem + env(safe-area-inset-bottom))"},children:e.jsxs(v,{size:"default",className:"rounded-full shadow-elevated gap-2",onClick:()=>r("/map"),children:[e.jsx(Ce,{className:"w-4 h-4"}),t("home.map")]})}),e.jsx(xe,{})]})};export{at as default};
