import{v as Q,r as i,j as e,y as q,z as F,o as X,R as Y,e as ee,s as te,d as M,P as I,g as C,A as T,f as z,E as re,F as oe,G as ae,H as se,I as ne,J as ie,K as le,L as ce,c as w,M as de,u as R,b as S,B as j,N as ue,a as pe,O as me,Q as O}from"./index-CBIizFiU.js";import{B as b}from"./bell-Dg8VrwxP.js";import{C as fe}from"./check-B3rdiUVc.js";import{m as v}from"./proxy-BEe99Z4a.js";import{S as xe}from"./search-BXGji4gq.js";import{B as he}from"./BottomNavigation-RRovRm9q.js";import{H as ge,u as ve}from"./useFavorites-DhgBgAAK.js";import{S as je}from"./star-Cp5w98QE.js";import{C as ye}from"./chevron-right-r5A-Xz5V.js";import{u as Ne}from"./useEstablishments--diq_h0L.js";import"./calendar-BD0_Bxkw.js";import"./user-CJDpa0Xs.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=Q("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);function Ce(r){const t=we(r),a=i.forwardRef((s,o)=>{const{children:n,...c}=s,l=i.Children.toArray(n),f=l.find(Re);if(f){const p=f.props.children,m=l.map(x=>x===f?i.Children.count(p)>1?i.Children.only(null):i.isValidElement(p)?p.props.children:null:x);return e.jsx(t,{...c,ref:o,children:i.isValidElement(p)?i.cloneElement(p,void 0,m):null})}return e.jsx(t,{...c,ref:o,children:n})});return a.displayName=`${r}.Slot`,a}function we(r){const t=i.forwardRef((a,s)=>{const{children:o,...n}=a;if(i.isValidElement(o)){const c=Oe(o),l=Ae(n,o.props);return o.type!==i.Fragment&&(l.ref=s?q(s,c):c),i.cloneElement(o,l)}return i.Children.count(o)>1?i.Children.only(null):null});return t.displayName=`${r}.SlotClone`,t}var Pe=Symbol("radix.slottable");function Re(r){return i.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===Pe}function Ae(r,t){const a={...t};for(const s in t){const o=r[s],n=t[s];/^on[A-Z]/.test(s)?o&&n?a[s]=(...l)=>{const f=n(...l);return o(...l),f}:o&&(a[s]=o):s==="style"?a[s]={...o,...n}:s==="className"&&(a[s]=[o,n].filter(Boolean).join(" "))}return{...r,...a}}function Oe(r){var s,o;let t=(s=Object.getOwnPropertyDescriptor(r.props,"ref"))==null?void 0:s.get,a=t&&"isReactWarning"in t&&t.isReactWarning;return a?r.ref:(t=(o=Object.getOwnPropertyDescriptor(r,"ref"))==null?void 0:o.get,a=t&&"isReactWarning"in t&&t.isReactWarning,a?r.props.ref:r.props.ref||r.ref)}var A="Popover",[B]=ee(A,[F]),P=F(),[Se,g]=B(A),D=r=>{const{__scopePopover:t,children:a,open:s,defaultOpen:o,onOpenChange:n,modal:c=!1}=r,l=P(t),f=i.useRef(null),[p,m]=i.useState(!1),[x,d]=X({prop:s,defaultProp:o??!1,onChange:n,caller:A});return e.jsx(Y,{...l,children:e.jsx(Se,{scope:t,contentId:te(),triggerRef:f,open:x,onOpenChange:d,onOpenToggle:i.useCallback(()=>d(u=>!u),[d]),hasCustomAnchor:p,onCustomAnchorAdd:i.useCallback(()=>m(!0),[]),onCustomAnchorRemove:i.useCallback(()=>m(!1),[]),modal:c,children:a})})};D.displayName=A;var L="PopoverAnchor",ke=i.forwardRef((r,t)=>{const{__scopePopover:a,...s}=r,o=g(L,a),n=P(a),{onCustomAnchorAdd:c,onCustomAnchorRemove:l}=o;return i.useEffect(()=>(c(),()=>l()),[c,l]),e.jsx(T,{...n,...s,ref:t})});ke.displayName=L;var $="PopoverTrigger",H=i.forwardRef((r,t)=>{const{__scopePopover:a,...s}=r,o=g($,a),n=P(a),c=M(t,o.triggerRef),l=e.jsx(I.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":K(o.open),...s,ref:c,onClick:C(r.onClick,o.onOpenToggle)});return o.hasCustomAnchor?l:e.jsx(T,{asChild:!0,...n,children:l})});H.displayName=$;var k="PopoverPortal",[Ee,_e]=B(k,{forceMount:void 0}),V=r=>{const{__scopePopover:t,forceMount:a,children:s,container:o}=r,n=g(k,t);return e.jsx(Ee,{scope:t,forceMount:a,children:e.jsx(z,{present:a||n.open,children:e.jsx(re,{asChild:!0,container:o,children:s})})})};V.displayName=k;var y="PopoverContent",W=i.forwardRef((r,t)=>{const a=_e(y,r.__scopePopover),{forceMount:s=a.forceMount,...o}=r,n=g(y,r.__scopePopover);return e.jsx(z,{present:s||n.open,children:n.modal?e.jsx(Me,{...o,ref:t}):e.jsx(Ie,{...o,ref:t})})});W.displayName=y;var Fe=Ce("PopoverContent.RemoveScroll"),Me=i.forwardRef((r,t)=>{const a=g(y,r.__scopePopover),s=i.useRef(null),o=M(t,s),n=i.useRef(!1);return i.useEffect(()=>{const c=s.current;if(c)return oe(c)},[]),e.jsx(ae,{as:Fe,allowPinchZoom:!0,children:e.jsx(U,{...r,ref:o,trapFocus:a.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:C(r.onCloseAutoFocus,c=>{var l;c.preventDefault(),n.current||(l=a.triggerRef.current)==null||l.focus()}),onPointerDownOutside:C(r.onPointerDownOutside,c=>{const l=c.detail.originalEvent,f=l.button===0&&l.ctrlKey===!0,p=l.button===2||f;n.current=p},{checkForDefaultPrevented:!1}),onFocusOutside:C(r.onFocusOutside,c=>c.preventDefault(),{checkForDefaultPrevented:!1})})})}),Ie=i.forwardRef((r,t)=>{const a=g(y,r.__scopePopover),s=i.useRef(!1),o=i.useRef(!1);return e.jsx(U,{...r,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:n=>{var c,l;(c=r.onCloseAutoFocus)==null||c.call(r,n),n.defaultPrevented||(s.current||(l=a.triggerRef.current)==null||l.focus(),n.preventDefault()),s.current=!1,o.current=!1},onInteractOutside:n=>{var f,p;(f=r.onInteractOutside)==null||f.call(r,n),n.defaultPrevented||(s.current=!0,n.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const c=n.target;((p=a.triggerRef.current)==null?void 0:p.contains(c))&&n.preventDefault(),n.detail.originalEvent.type==="focusin"&&o.current&&n.preventDefault()}})}),U=i.forwardRef((r,t)=>{const{__scopePopover:a,trapFocus:s,onOpenAutoFocus:o,onCloseAutoFocus:n,disableOutsidePointerEvents:c,onEscapeKeyDown:l,onPointerDownOutside:f,onFocusOutside:p,onInteractOutside:m,...x}=r,d=g(y,a),u=P(a);return se(),e.jsx(ne,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:o,onUnmountAutoFocus:n,children:e.jsx(ie,{asChild:!0,disableOutsidePointerEvents:c,onInteractOutside:m,onEscapeKeyDown:l,onPointerDownOutside:f,onFocusOutside:p,onDismiss:()=>d.onOpenChange(!1),children:e.jsx(le,{"data-state":K(d.open),role:"dialog",id:d.contentId,...u,...x,ref:t,style:{...x.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),G="PopoverClose",Te=i.forwardRef((r,t)=>{const{__scopePopover:a,...s}=r,o=g(G,a);return e.jsx(I.button,{type:"button",...s,ref:t,onClick:C(r.onClick,()=>o.onOpenChange(!1))})});Te.displayName=G;var ze="PopoverArrow",Be=i.forwardRef((r,t)=>{const{__scopePopover:a,...s}=r,o=P(a);return e.jsx(ce,{...o,...s,ref:t})});Be.displayName=ze;function K(r){return r?"open":"closed"}var De=D,Le=H,$e=V,Z=W;const He=De,Ve=Le,J=i.forwardRef(({className:r,align:t="center",sideOffset:a=4,...s},o)=>e.jsx($e,{children:e.jsx(Z,{ref:o,align:t,sideOffset:a,className:w("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...s})}));J.displayName=Z.displayName;function We(){const{notifications:r,unreadCount:t,markAsRead:a,markAllAsRead:s,loading:o,error:n,refetch:c}=de(),[l,f]=i.useState(!1),p=R(),{t:m}=S();i.useEffect(()=>{l&&console.log("游댒 [NotificationsDropdown] Opened - State:",{notificationsCount:r.length,unreadCount:t,loading:o,error:n,notifications:r.map(d=>({id:d.id,title:d.title,read:d.read,type:d.type}))})},[l,r,t,o,n]);const x=d=>{d.read||a(d.id),f(!1),p(`/notifications/${d.id}`)};return i.useEffect(()=>{l&&c()},[l,c]),e.jsxs(He,{open:l,onOpenChange:f,children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(j,{variant:"ghost",size:"icon",className:"text-muted-foreground relative",children:[e.jsx(b,{className:"w-5 h-5"}),t>0&&e.jsx("span",{className:"absolute -top-0.5 -right-0.5 min-w-[18px] h-[18px] px-1 bg-primary text-primary-foreground text-xs font-bold rounded-full flex items-center justify-center",children:t})]})}),e.jsxs(J,{className:"w-80 p-0",align:"end",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-border",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:m("notifications.title")}),t>0&&e.jsxs(j,{variant:"ghost",size:"sm",onClick:s,className:"text-xs text-primary hover:text-primary/80",children:[e.jsx(fe,{className:"w-3 h-3 mr-1"}),m("notifications.markAllRead")]})]}),e.jsx("div",{className:"max-h-80 overflow-y-auto",children:o?e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[e.jsx(b,{className:"w-10 h-10 mx-auto mb-2 opacity-50 animate-pulse"}),e.jsx("p",{children:m("common.loading")||"Cargando..."})]}):n?e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[e.jsx(b,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),e.jsxs("p",{className:"text-red-500 text-sm",children:["Error: ",n]})]}):r.length===0?e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[e.jsx(b,{className:"w-10 h-10 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:m("notifications.noNotifications")||"No tienes notificaciones"})]}):r.slice(0,10).map(d=>e.jsxs("button",{onClick:()=>x(d),className:w("w-full flex items-start gap-3 p-4 text-left transition-colors hover:bg-gray-50/50 border-b border-gray-100 last:border-0",d.read&&"opacity-70"),children:[e.jsx("div",{className:"flex-shrink-0 pt-1",children:d.read?e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-gray-300"}):e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("p",{className:w("font-semibold text-[15px]",d.read?"text-gray-600":"text-gray-900"),children:d.title})}),e.jsx("p",{className:w("text-sm line-clamp-2 mb-1 leading-relaxed",d.read?"text-gray-500":"text-gray-600"),children:d.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:d.time})]})]},d.id))}),e.jsx("div",{className:"p-3 border-t border-border",children:e.jsx(ue,{to:"/notifications",onClick:()=>f(!1),children:e.jsx(j,{variant:"ghost",size:"sm",className:"w-full text-primary",children:m("notifications.viewAll")})})})]})]})}function Ue(){const r=R(),[t,a]=i.useState(!1);return i.useEffect(()=>{const s=setTimeout(()=>{a(!0),setTimeout(()=>a(!1),1500)},2e3),o=setInterval(()=>{a(!0),setTimeout(()=>a(!1),1500)},1e4);return()=>{clearInterval(o),clearTimeout(s)}},[]),e.jsx("header",{className:"sticky top-0 z-40 bg-card/80 backdrop-blur-md border-b border-border",style:{paddingTop:"env(safe-area-inset-top)"},children:e.jsxs("div",{className:"flex items-center justify-between h-16 px-4 max-w-lg mx-auto relative",children:[e.jsxs(v.div,{className:"relative",animate:t?{x:[-2,2,-2,2,-2,2,0],scale:[1,1.05,1,1.05,1]}:{},transition:{duration:.5,ease:"easeInOut"},children:[e.jsx("h1",{className:"text-xl font-bold text-foreground",children:"M칤 Turnow"}),e.jsx(v.div,{className:"absolute -top-1 -right-6",animate:t?{rotate:[-15,15,-15,15,-15,15,0],scale:[1,1.2,1,1.2,1]}:{scale:1},transition:{duration:.6,ease:"easeInOut"},children:e.jsxs(v.div,{className:"relative",animate:t?{opacity:1}:{opacity:.3},children:[e.jsx(b,{className:`w-5 h-5 ${t?"text-orange-500":"text-gray-400"}`,strokeWidth:2.5,fill:t?"currentColor":"none"}),t&&e.jsx(v.div,{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-orange-500 rounded-full",animate:{scale:[0,1.3,1],opacity:[0,1,1]},transition:{duration:.3}}),t&&e.jsxs(e.Fragment,{children:[e.jsx(v.div,{className:"absolute inset-0 rounded-full border-2 border-orange-500",initial:{scale:1,opacity:.8},animate:{scale:[1,2],opacity:[.8,0]},transition:{duration:1,ease:"easeOut"}}),e.jsx(v.div,{className:"absolute inset-0 rounded-full border-2 border-orange-400",initial:{scale:1,opacity:.6},animate:{scale:[1,2.5],opacity:[.6,0]},transition:{duration:1.2,delay:.2,ease:"easeOut"}})]})]})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>r("/search"),className:"text-muted-foreground",children:e.jsx(xe,{className:"w-5 h-5"})}),e.jsx(We,{})]})]})})}const Ge=i.memo(function({business:t,onToggleFavorite:a}){const s=R(),{t:o}=S(),n=()=>{s(`/business/${t.id}`)},c=m=>{m.stopPropagation(),a==null||a(t.id)},l=m=>m.toLocaleString(),p=(m=>{if(!m)return"";const x=m.replace(/_/g,"-"),d=o(`categories.${x}`);return d&&d!==`categories.${x}`?d:""})(t.category);return e.jsxs("div",{onClick:n,className:"flex-shrink-0 w-[180px] cursor-pointer group",children:[e.jsxs("div",{className:"relative",children:[t.imageUrl?e.jsx("img",{src:t.imageUrl,alt:t.name,loading:"lazy",className:"w-full aspect-[16/11] rounded-xl object-cover transition-transform duration-300 group-hover:scale-105"}):e.jsx("div",{className:"w-full aspect-[16/11] rounded-xl flex items-center justify-center bg-gradient-to-br from-primary/20 to-primary/5",children:e.jsx("span",{className:"text-4xl font-bold text-primary/30",children:t.name.charAt(0).toUpperCase()})}),e.jsx("button",{onClick:c,className:"absolute top-2.5 right-2.5 w-8 h-8 rounded-full bg-white/90 backdrop-blur-sm flex items-center justify-center transition-all duration-200 hover:bg-white hover:scale-110 shadow-sm z-10 opacity-0 group-hover:opacity-100",children:e.jsx(ge,{className:w("w-4 h-4 transition-colors",t.isFavorite?"fill-red-500 text-red-500":"text-gray-400")})})]}),e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("h3",{className:"font-semibold text-[15px] text-gray-900 leading-tight line-clamp-2",children:t.name}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(je,{className:"w-4 h-4 fill-yellow-400 text-yellow-400 flex-shrink-0"}),e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:t.rating.toFixed(1)}),t.reviewCount>0&&e.jsxs("span",{className:"text-sm text-gray-600 font-normal",children:["(",l(t.reviewCount),")"]})]}),t.address&&e.jsx("p",{className:"text-xs text-gray-600 leading-relaxed line-clamp-1",children:t.address}),p&&e.jsx("p",{className:"text-xs text-gray-600 leading-relaxed",children:p})]})]})}),_=i.memo(function({title:t,businesses:a,onToggleFavorite:s,showViewAll:o=!1,onViewAll:n,isFirstSection:c=!1}){return a.length===0?null:e.jsxs("section",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between px-4",children:[e.jsx("h2",{className:"text-lg font-bold text-foreground",children:t}),o&&e.jsxs("button",{onClick:n,className:"flex items-center gap-1 text-sm text-primary font-medium hover:underline",children:["Ver todo",e.jsx(ye,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"overflow-x-auto pb-3 scrollbar-hide",style:{WebkitOverflowScrolling:"touch",scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx("div",{className:"flex gap-4 snap-x snap-mandatory",style:{paddingLeft:"max(env(safe-area-inset-left, 0px), 1rem)",paddingRight:"max(env(safe-area-inset-right, 0px), 1rem)"},children:a.map(l=>e.jsx("div",{className:"snap-start",children:e.jsx(Ge,{business:l,onToggleFavorite:s})},l.id))})})]})}),Ke={barberia:"Barber칤a",barber:"Barber칤a",salon:"Sal칩n de Belleza","hair-salon":"Sal칩n de Belleza",spa:"Spa & Bienestar","spa-sauna":"Spa & Bienestar",nails:"U침as",beauty:"Belleza","beauty-salon":"Belleza",massage:"Masajes",medspa:"Med Spa",general:"Establecimientos",other:"Otros"},nt=()=>{const r=R(),{t}=S(),{user:a,isGuest:s}=pe(),{establishments:o,loading:n,error:c}=Ne(),{isFavorite:l,toggleFavorite:f}=ve(),p=i.useMemo(()=>o.map(u=>{const N=(u.category||u.primary_category||"general").replace(/_/g,"-");return{id:u.id,name:u.name,rating:u.rating||0,reviewCount:u.review_count||0,address:u.address||void 0,category:N,imageUrl:u.main_image||"",isFavorite:l(u.id)}}),[o,l]),m=i.useMemo(()=>{const u={};return p.forEach(h=>{var E;const N=((E=h.category)==null?void 0:E.toLowerCase())||"general";u[N]||(u[N]=[]),u[N].push(h)}),u},[p]),x=i.useMemo(()=>Object.keys(m).sort((u,h)=>m[h].length-m[u].length),[m]),d=async u=>{if(!a&&!s){O({title:t("common.error"),description:"Debes iniciar sesi칩n para guardar favoritos",variant:"destructive"});return}if(s){O({title:t("common.error"),description:"Los invitados no pueden guardar favoritos. Crea una cuenta.",variant:"destructive"});return}const{error:h}=await f(u);h&&O({title:t("common.error"),description:"No se pudo actualizar favoritos",variant:"destructive"})};return n?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsx(me,{className:"w-8 h-8 animate-spin text-primary"})}):c?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-destructive mb-4",children:[t("common.error"),": ",c]}),e.jsx(j,{onClick:()=>window.location.reload(),children:t("common.retry")})]})}):e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx(Ue,{}),e.jsxs("main",{className:"py-5 space-y-8",style:{paddingInline:"0",boxSizing:"border-box"},children:[p.length>0&&e.jsx(_,{title:t("home.allEstablishments"),businesses:p,onToggleFavorite:d,isFirstSection:!0}),x.map(u=>{const h=m[u];return h.length===0||x.length===1&&u==="general"?null:e.jsx(_,{title:Ke[u]||u,businesses:h,onToggleFavorite:d},u)}),p.length===0&&e.jsx("div",{className:"text-center py-12 px-4 animate-fade-in",children:e.jsx("p",{className:"text-muted-foreground",children:t("common.noResults")})})]}),e.jsx("div",{className:"fixed left-1/2 -translate-x-1/2 z-40",style:{bottom:"calc(clamp(4rem, 12vw, 4.5rem) + 2.5rem + 0.5rem + env(safe-area-inset-bottom))"},children:e.jsxs(j,{size:"default",className:"rounded-full shadow-elevated gap-2",onClick:()=>r("/map"),children:[e.jsx(be,{className:"w-4 h-4"}),t("home.map")]})}),e.jsx(he,{})]})};export{nt as default};
