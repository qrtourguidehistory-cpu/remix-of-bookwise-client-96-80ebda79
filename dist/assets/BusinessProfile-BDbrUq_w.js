import{o as le,j as e,C as R,B as f,r as c,s as S,K as ce,u as ie,b as de,a as ue,L as B,J as G,c as T}from"./index-DdwKk-nk.js";import{I as me,a as xe}from"./ImageCarousel-Jevx29aa.js";import{a as fe}from"./useEstablishments-Bdlwz7n8.js";import{u as ge,H as pe}from"./useFavorites-BNpsI3n7.js";import{u as he,g as je}from"./useBusinessHours-B8qm9yT1.js";import{S as D}from"./skeleton-CAfbsAZr.js";import{Browser as Ne}from"./index-BCwJQrrK.js";import{f as ye}from"./format-CWMu7BRU.js";import{A as O}from"./arrow-left-b5XW7h6v.js";import{S as we}from"./star-uFnFh7Za.js";import{M as A}from"./map-pin-Bds0B8oc.js";import{P as be}from"./phone-DWP_Pr9c.js";import{E as H}from"./external-link-DY3CAi7-.js";import"./chevron-left-CkA_g7Ju.js";import"./chevron-right-DxdR6v9r.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=le("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);function _e({service:o,onSelect:g,selected:t}){o.currency;const y=o.price_rd!==void 0&&o.price_rd!==null?Number(o.price_rd):o.price?Number(o.price):0,p=o.price_usd!==void 0&&o.price_usd!==null?Number(o.price_usd):0;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-card rounded-xl border border-border hover:border-primary/30 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-4",children:[e.jsx("h4",{className:"font-medium text-foreground",children:o.name}),o.description&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1 mt-0.5",children:o.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-muted-foreground",children:[e.jsx(R,{className:"w-3.5 h-3.5 text-gray-600",strokeWidth:2}),e.jsxs("span",{children:[o.duration," min"]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-foreground",children:["RD$ ",y.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["USD $",p.toFixed(2)]})]}),e.jsx(f,{variant:t?"coral":"coral-outline",size:"sm",onClick:()=>g(o),children:t?"Seleccionado":"Seleccionar"})]})]})}function Se(o){const[g,t]=c.useState([]),[y,p]=c.useState(!1),[k,b]=c.useState(null);return c.useEffect(()=>{if(!o){t([]);return}(async()=>{p(!0),b(null);try{let i=[];try{const{data:m,error:w}=await S.storage.from("Galeria").list(o,{limit:100,offset:0});!w&&m&&(i=m.filter(h=>{var u;const a=(u=h.name.split(".").pop())==null?void 0:u.toLowerCase();return a&&["jpg","jpeg","png","webp","gif"].includes(a)}).map(h=>{const{data:{publicUrl:a}}=S.storage.from("Galeria").getPublicUrl(`${o}/${h.name}`);return a}))}catch(m){console.warn("No se encontraron imÃ¡genes en carpeta especÃ­fica:",m)}if(i.length===0)try{const{data:m,error:w}=await S.storage.from("Galeria").list("",{limit:1e3,offset:0});!w&&m&&(i=m.filter(a=>{var u;return a.name.includes(o)||((u=a.id)==null?void 0:u.includes(o))}).filter(a=>{var j;const u=(j=a.name.split(".").pop())==null?void 0:j.toLowerCase();return u&&["jpg","jpeg","png","webp","gif"].includes(u)}).map(a=>{const{data:{publicUrl:u}}=S.storage.from("Galeria").getPublicUrl(a.name);return u}))}catch(m){console.warn("No se encontraron imÃ¡genes en la raÃ­z:",m)}t(i)}catch(i){console.error("Error fetching gallery images:",i),i.message&&!i.message.includes("not found")&&b(i.message),t([])}finally{p(!1)}})()},[o]),{galleryImages:g,loading:y,error:k}}const Ge=()=>{const{id:o}=ce(),g=ie(),{t}=de(),{user:y,isGuest:p}=ue(),{isFavorite:k,toggleFavorite:b}=ge(),{establishment:s,services:i,paymentMethods:m,loading:w,error:h,refetch:a}=fe(o),{hours:u}=he(o),{galleryImages:j}=Se(o),[x,W]=c.useState([]),[q,U]=c.useState(!1),[V,M]=c.useState(!1),v=c.useRef(null),_=c.useRef(null),N=c.useMemo(()=>{if(!s||!s.temporarily_closed)return!1;if(!s.closed_until)return s.temporarily_closed;const r=new Date(s.closed_until),n=new Date;return s.temporarily_closed===!0&&r>n},[s]);c.useEffect(()=>{if(!(s!=null&&s.temporarily_closed)||!(s!=null&&s.closed_until))return;const r=new Date(s.closed_until),n=new Date;if(r<=n)return;const d=r.getTime()-n.getTime(),l=setTimeout(()=>{a()},d+1e3);return()=>clearTimeout(l)},[s==null?void 0:s.closed_until,s==null?void 0:s.temporarily_closed,a]),c.useEffect(()=>{if(!(s!=null&&s.temporarily_closed)||!(s!=null&&s.closed_until))return;const r=setInterval(()=>{new Date(s.closed_until)<=new Date&&a()},3e4);return()=>clearInterval(r)},[s==null?void 0:s.closed_until,s==null?void 0:s.temporarily_closed,a]);const P=c.useMemo(()=>{if(!N||!(s!=null&&s.closed_until))return null;try{const r=new Date(s.closed_until);return ye(r,"HH:mm")}catch{return null}},[N,s==null?void 0:s.closed_until]),Y=async()=>{if(!q){U(!0);try{await a()}finally{U(!1)}}},J=r=>{v.current=r.touches[0].clientY},K=r=>{_.current=r.touches[0].clientY},Q=()=>{if(!v.current||!_.current)return;v.current-_.current<-50&&window.scrollY===0&&Y(),v.current=null,_.current=null},F=c.useMemo(()=>{if(N)return!1;const r=new Date,n=u||je(o),d=C=>{const[E,ae]=C.split(":").map(Number);return E*60+ae},l=r.getHours()*60+r.getMinutes(),z=d(n.openTime),oe=d(n.closeTime);if(n.lunchStart&&n.lunchEnd){const C=d(n.lunchStart),E=d(n.lunchEnd);if(l>=C&&l<E)return!1}return l>=z&&l<oe},[u,o,N]),X=r=>{W(n=>n.find(l=>l.id===r.id)?n.filter(l=>l.id!==r.id):[...n,r])},Z=async()=>{if(p||!y){G({title:t("common.loginRequired"),description:t("favorites.loginToSave"),variant:"destructive"});return}o&&await b(o)},ee=x.reduce((r,n)=>r+(n.price_rd||n.price||0),0),I=x.reduce((r,n)=>r+(n.price_usd||0),0),se=x.reduce((r,n)=>r+n.duration,0),re=()=>{const r=(s==null?void 0:s.phone)||"";r&&(window.location.href=`tel:${r.replace(/\s/g,"")}`)},te=async()=>{const r=s==null?void 0:s.latitude,n=s==null?void 0:s.longitude,d=s==null?void 0:s.address;let l="";if(r&&n)l=`https://www.google.com/maps/search/?api=1&query=${r},${n}`,console.log("ðŸ“ NAVEGANDO CON COORDENADAS GPS:",{lat:r,lng:n}),console.log("ðŸ”— URL:",l);else if(d)l=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(d)}`,console.log("ðŸ“ NAVEGANDO CON DIRECCIÃ“N (sin coordenadas):",d),console.log("ðŸ”— URL:",l);else{console.error("âŒ Sin coordenadas ni direcciÃ³n disponible");return}try{await Ne.open({url:l,presentationStyle:"popover"})}catch{window.open(l,"_blank")}},$=c.useMemo(()=>{const r=[];return s!=null&&s.cover_image_url&&r.push(s.cover_image_url),j.length>0&&r.push(...j),r.length===0&&(s!=null&&s.main_image)&&r.push(s.main_image),r},[s==null?void 0:s.cover_image_url,s==null?void 0:s.main_image,j]),L=c.useMemo(()=>(console.log("BusinessProfile - dbServices received:",i.length,i.map(r=>({id:r.id,name:r.name}))),i.map(r=>{const n=r.price_rd!==void 0?Number(r.price_rd):Number(r.price||0),d=r.price_usd!==void 0?Number(r.price_usd):0;return{id:r.id,name:r.name,description:r.description||"",duration:r.duration_minutes||30,price:Number(r.price||0),price_rd:n,price_usd:d,price_currency:r.price_currency||"DOP",currency:r.price_currency||"DOP"}})),[i]);if(w)return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsxs("div",{className:"relative h-56 bg-gradient-to-br from-secondary to-muted",children:[e.jsx(D,{className:"w-full h-full"}),e.jsx("div",{className:"absolute top-0 left-0 right-0 p-4 flex items-center justify-between z-10",children:e.jsx(f,{variant:"secondary",size:"icon",className:"rounded-full",onClick:()=>g(-1),children:e.jsx(O,{className:"w-5 h-5"})})})]}),e.jsx("div",{className:"max-w-lg mx-auto px-4 -mt-8 relative z-10",children:e.jsxs("div",{className:"bg-card rounded-2xl shadow-card p-5",children:[e.jsx(D,{className:"h-6 w-48 mb-2"}),e.jsx(D,{className:"h-4 w-32 mb-3"}),e.jsx(D,{className:"h-20 w-full"})]})})]});if(h||!s)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:e.jsxs("div",{className:"text-center px-4",children:[e.jsx("h2",{className:"text-xl font-bold text-foreground mb-2",children:t("common.error")}),e.jsx("p",{className:"text-muted-foreground mb-4",children:t("business.notFound")}),e.jsx(f,{variant:"coral",onClick:()=>g("/"),children:t("common.goBack")})]})});const ne=o?k(o):!1;return e.jsxs("div",{className:"min-h-screen bg-background",onTouchStart:J,onTouchMove:K,onTouchEnd:Q,children:[e.jsxs("div",{className:"relative h-56 bg-gradient-to-br from-secondary to-muted",children:[$.length>0?e.jsx(me,{images:$,alt:s.name,clickable:!0}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-muted",children:e.jsx("span",{className:"text-muted-foreground",children:t("business.noImage")})}),e.jsxs("div",{className:"absolute top-0 left-0 right-0 p-4 flex items-center justify-between z-10",children:[e.jsx(B,{to:"/",children:e.jsx(f,{variant:"secondary",size:"icon",className:"rounded-full shadow-card",children:e.jsx(O,{className:"w-5 h-5"})})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{variant:"secondary",size:"icon",className:"rounded-full shadow-card",onClick:()=>{const r=window.location.href,n=`Check out ${s.name}!`;navigator.share?navigator.share({title:s.name,text:n,url:r}):(navigator.clipboard.writeText(r),G({title:t("common.linkCopied")}))},children:e.jsx(ve,{className:"w-5 h-5"})}),e.jsx(f,{variant:"secondary",size:"icon",className:"rounded-full shadow-card",onClick:Z,children:e.jsx(pe,{className:T("w-5 h-5 transition-colors",ne&&"fill-primary text-primary")})})]})]})]}),e.jsxs("div",{className:T("max-w-lg mx-auto px-4 -mt-8 relative z-10",x.length>0?"pb-36":"pb-8"),children:[e.jsxs("div",{className:"bg-card rounded-2xl shadow-card p-5 animate-slide-up relative",children:[e.jsx("h1",{className:"text-xl font-bold text-foreground mb-2",children:s.name}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"w-4 h-4 text-warning fill-warning"}),e.jsx("span",{className:"font-semibold text-foreground",children:s.rating||0}),e.jsxs("span",{className:"text-muted-foreground text-sm",children:["(",s.review_count||0," ",t("business.reviews"),")"]})]}),s.address&&e.jsxs("span",{className:"flex items-center gap-1 text-muted-foreground text-sm",children:[e.jsx(A,{className:"w-4 h-4 text-gray-700",strokeWidth:2}),s.address]})]}),s.logo_url&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:s.logo_url,alt:`${s.name} logo`,className:"w-12 h-12 rounded-full object-cover border-2 border-white shadow-md cursor-pointer hover:scale-105 transition-transform flex-shrink-0",onClick:()=>M(!0)}),e.jsx(xe,{images:[s.logo_url],initialIndex:0,isOpen:V,onClose:()=>M(!1),alt:`${s.name} logo`})]})]}),s.description&&e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:s.description}),e.jsx("div",{className:"flex items-center gap-4 text-sm",children:N?e.jsxs("div",{className:"flex flex-col gap-1 w-full bg-warning/10 p-3 rounded-lg border border-warning/20 animate-fade-in",children:[e.jsxs("span",{className:"flex items-center gap-1.5 text-destructive font-semibold",children:[e.jsx(R,{className:"w-4 h-4",strokeWidth:2}),t("business.temporarilyClosed")]}),P&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:[t("business.reopensAt")," ",P]})]}):e.jsxs("span",{className:T("flex items-center gap-1.5",F?"text-success":"text-destructive"),children:[e.jsx(R,{className:"w-4 h-4 text-gray-700",strokeWidth:2}),t(F?"business.openNow":"business.closedNow")]})})]}),e.jsxs("section",{className:"mt-6 animate-slide-up",style:{animationDelay:"0.1s"},children:[e.jsx("h2",{className:"text-lg font-bold text-foreground mb-4",children:t("business.services")}),L.length>0?e.jsx("div",{className:"space-y-3",children:L.map(r=>e.jsx(_e,{service:r,onSelect:X,selected:x.some(n=>n.id===r.id)},r.id))}):e.jsx("div",{className:"bg-card rounded-xl border border-border p-4 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:t("business.noServices")})})]}),(s.phone||s.address)&&e.jsxs("section",{className:"mt-6 animate-slide-up",style:{animationDelay:"0.15s"},children:[e.jsx("h2",{className:"text-lg font-bold text-foreground mb-4",children:t("business.contact")}),e.jsxs("div",{className:"bg-card rounded-xl border border-border p-4 space-y-3",children:[s.phone&&e.jsxs("button",{onClick:re,className:"w-full flex items-center gap-3 hover:bg-secondary/50 -mx-2 px-2 py-2 rounded-lg transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center",children:e.jsx(be,{className:"w-5 h-5 text-gray-700",strokeWidth:2})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("business.phone")}),e.jsx("p",{className:"font-medium text-foreground",children:s.phone})]}),e.jsx(H,{className:"w-4 h-4 text-gray-500",strokeWidth:2})]}),s.address&&e.jsxs("button",{onClick:te,className:"w-full flex items-center gap-3 hover:bg-secondary/50 -mx-2 px-2 py-2 rounded-lg transition-colors",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center",children:e.jsx(A,{className:"w-5 h-5 text-gray-700",strokeWidth:2})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:t("business.address")}),e.jsx("p",{className:"font-medium text-foreground",children:s.address})]}),e.jsx(H,{className:"w-4 h-4 text-gray-500",strokeWidth:2})]})]})]}),e.jsxs("section",{className:"mt-6 animate-slide-up",style:{animationDelay:"0.2s"},children:[e.jsx("h2",{className:"text-lg font-bold text-foreground mb-4",children:t("business.paymentMethods")}),e.jsxs("div",{className:"bg-card rounded-xl border border-border p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:t("business.paymentMethodsDesc")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.length>0?m.map(r=>e.jsx("span",{className:"px-3 py-1 bg-secondary text-secondary-foreground text-xs rounded-full",children:r.name},r.id)):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"px-3 py-1 bg-secondary text-secondary-foreground text-xs rounded-full",children:t("business.cash")}),e.jsx("span",{className:"px-3 py-1 bg-secondary text-secondary-foreground text-xs rounded-full",children:t("business.creditCard")})]})})]})]}),e.jsxs("section",{className:"mt-6 animate-slide-up",style:{animationDelay:"0.25s"},children:[e.jsx("h2",{className:"text-lg font-bold text-foreground mb-4",children:t("business.cancellationPolicy")}),e.jsxs("div",{className:"bg-warning/10 rounded-xl border border-warning/20 p-4",children:[e.jsxs("p",{className:"text-sm text-foreground",children:[t("business.cancellationPolicyText")," ",e.jsx("strong",{children:t("business.cancellationHours")}),"."]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:t("business.cancellationNote")})]})]})]}),x.length>0&&e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-card border-t border-border p-4 shadow-elevated z-50 animate-slide-up",style:{paddingBottom:"calc(1rem + env(safe-area-inset-bottom))"},children:e.jsxs("div",{className:"max-w-lg mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[x.length," ",t("business.services_count")," â€¢ ",se," ",t("business.min")]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-foreground",children:["RD$ ",ee.toLocaleString()]}),I>0&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["USD $",I.toFixed(2)]})]})]})}),N?e.jsx(f,{variant:"coral",size:"xl",className:"w-full",disabled:!0,children:t("business.temporarilyClosed")}):e.jsx(B,{to:`/booking/${o}`,state:{services:x},children:e.jsx(f,{variant:"coral",size:"xl",className:"w-full",children:t("business.continueBooking")})})]})})]})};export{Ge as default};
