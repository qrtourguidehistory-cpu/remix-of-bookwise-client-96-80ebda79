import{u as D,b as _,a as E,r as i,s as y,j as e,B as l,C as L,J as p}from"./index-DQJT4g5E.js";import{B as k}from"./BottomNavigation-BUhWCQHl.js";import{S as B}from"./skeleton-BDRgUS51.js";import{T}from"./textarea-De3sc5CW.js";import{A as R}from"./arrow-left-COyHvJ2K.js";import{S as m}from"./star-BhxkPCl1.js";import"./calendar-D8Y6luEC.js";import"./user-DyqSMMvV.js";const H=()=>{const f=D(),{t}=_(),{user:n}=E(),[d,S]=i.useState([]),[C,b]=i.useState(!0),[c,x]=i.useState(null),[u,h]=i.useState(0),[j,g]=i.useState("");i.useEffect(()=>{n?v():b(!1)},[n]);const v=async()=>{try{const{data:s,error:r}=await y.from("reviews").select(`
          *,
          businesses:business_id (business_name)
        `).eq("user_id",n==null?void 0:n.id).order("created_at",{ascending:!1});if(r)throw r;const a=(s||[]).map(o=>({...o,establishment:o.businesses?{name:o.businesses.business_name}:void 0,business:o.businesses}));S(a)}catch(s){console.error("Error fetching reviews:",s)}finally{b(!1)}},z=async()=>{if(!c||u===0){p({title:t("common.error"),description:t("reviews.selectRating"),variant:"destructive"});return}try{const{error:s}=await y.from("reviews").update({rating:u,comment:j||null,status:"completed"}).eq("id",c.id);if(s)throw s;p({title:t("common.success"),description:t("reviews.thankYou")}),x(null),h(0),g(""),v()}catch(s){console.error("Error submitting review:",s),p({title:t("common.error"),description:t("reviews.submitError"),variant:"destructive"})}},w=d.filter(s=>s.status==="pending"),N=d.filter(s=>s.status==="completed");return C?e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-card border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-4 h-14 px-4 max-w-lg mx-auto",children:[e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>f(-1),children:e.jsx(R,{className:"w-5 h-5"})}),e.jsx("h1",{className:"font-semibold text-foreground",children:t("reviews.title")})]})}),e.jsx("main",{className:"max-w-lg mx-auto px-4 py-6 space-y-4",children:[1,2,3].map(s=>e.jsx(B,{className:"h-32 rounded-xl"},s))}),e.jsx(k,{})]}):e.jsxs("div",{className:"min-h-screen bg-background pb-20",children:[e.jsx("header",{className:"sticky top-0 z-40 bg-card border-b border-border",children:e.jsxs("div",{className:"flex items-center gap-4 h-14 px-4 max-w-lg mx-auto",children:[e.jsx(l,{variant:"ghost",size:"icon",onClick:()=>f(-1),children:e.jsx(R,{className:"w-5 h-5"})}),e.jsx("h1",{className:"font-semibold text-foreground",children:t("reviews.title")})]})}),e.jsxs("main",{className:"max-w-lg mx-auto px-4 py-6 space-y-6",children:[w.length>0&&e.jsxs("section",{className:"animate-fade-in",children:[e.jsxs("h2",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide mb-3 flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4"}),t("reviews.pendingToRate")]}),e.jsx("div",{className:"space-y-3",children:w.map(s=>{var r;return e.jsxs("div",{className:"bg-card rounded-xl border border-border p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:((r=s.establishment)==null?void 0:r.name)||t("reviews.establishment")}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(s.created_at||"").toLocaleDateString()})]}),e.jsx("span",{className:"px-2 py-1 bg-warning/10 text-warning text-xs font-medium rounded-full",children:t("reviews.pending")})]}),(c==null?void 0:c.id)===s.id?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(a=>e.jsx("button",{onClick:()=>h(a),className:"p-1",children:e.jsx(m,{className:`w-8 h-8 ${a<=u?"text-warning fill-warning":"text-muted-foreground"}`})},a))}),e.jsx(T,{placeholder:t("reviews.shareFeedback"),value:j,onChange:a=>g(a.target.value),maxLength:500}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{x(null),h(0),g("")},children:t("common.cancel")}),e.jsx(l,{variant:"coral",size:"sm",onClick:z,children:t("reviews.submitReview")})]})]}):e.jsx(l,{variant:"coral",size:"sm",onClick:()=>x(s),children:t("reviews.rateNow")})]},s.id)})})]}),N.length>0&&e.jsxs("section",{className:"animate-fade-in",style:{animationDelay:"0.1s"},children:[e.jsxs("h2",{className:"text-sm font-semibold text-muted-foreground uppercase tracking-wide mb-3 flex items-center gap-2",children:[e.jsx(m,{className:"w-4 h-4"}),t("reviews.completedReviews")]}),e.jsx("div",{className:"space-y-3",children:N.map(s=>{var r;return e.jsxs("div",{className:"bg-card rounded-xl border border-border p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("p",{className:"font-medium text-foreground",children:((r=s.establishment)==null?void 0:r.name)||t("reviews.establishment")}),e.jsx("div",{className:"flex",children:[1,2,3,4,5].map(a=>e.jsx(m,{className:`w-4 h-4 ${a<=(s.rating||0)?"text-warning fill-warning":"text-muted-foreground"}`},a))})]}),s.comment&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.comment}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:new Date(s.created_at||"").toLocaleDateString()})]},s.id)})})]}),d.length===0&&e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-coral-light flex items-center justify-center mx-auto mb-4",children:e.jsx(m,{className:"w-10 h-10 text-coral"})}),e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:t("reviews.noReviews")}),e.jsx("p",{className:"text-muted-foreground",children:t("reviews.noReviewsDesc")})]})]}),e.jsx(k,{})]})};export{H as default};
